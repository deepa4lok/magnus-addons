<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=emulateIE7" />
    <title>Coverage for /tmp/parts/odoo/addons/account/models/account.py: 44%</title>
    <link rel="icon" sizes="32x32" href="favicon_32.png">
    <link rel="stylesheet" href="style.css" type="text/css">
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="jquery.hotkeys.js"></script>
    <script type="text/javascript" src="jquery.isonscreen.js"></script>
    <script type="text/javascript" src="coverage_html.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(coverage.pyfile_ready);
    </script>
</head>
<body class="pyfile">
<div id="header">
    <div class="content">
        <h1>Coverage for <b>/tmp/parts/odoo/addons/account/models/account.py</b> :
            <span class="pc_cov">44%</span>
        </h1>
        <img id="keyboard_icon" src="keybd_closed.png" alt="Show keyboard shortcuts" />
        <h2 class="stats">
            497 statements &nbsp;
            <button type="button" class="run shortkey_r button_toggle_run" title="Toggle lines run">219 run</button>
            <button type="button" class="mis show_mis shortkey_m button_toggle_mis" title="Toggle lines missing">278 missing</button>
            <button type="button" class="exc show_exc shortkey_x button_toggle_exc" title="Toggle lines excluded">0 excluded</button>
        </h2>
    </div>
</div>
<div class="help_panel">
    <img id="panel_icon" src="keybd_open.png" alt="Hide keyboard shortcuts" />
    <p class="legend">Hot-keys on this page</p>
    <div>
    <p class="keyhelp">
        <span class="key">r</span>
        <span class="key">m</span>
        <span class="key">x</span>
        <span class="key">p</span> &nbsp; toggle line displays
    </p>
    <p class="keyhelp">
        <span class="key">j</span>
        <span class="key">k</span> &nbsp; next/prev highlighted chunk
    </p>
    <p class="keyhelp">
        <span class="key">0</span> &nbsp; (zero) top of page
    </p>
    <p class="keyhelp">
        <span class="key">1</span> &nbsp; (one) first highlighted chunk
    </p>
    </div>
</div>
<div id="source">
    <p id="t1" class="pln"><span class="n"><a href="#t1">1</a></span><span class="t"><span class="com"># -*- coding: utf-8 -*-</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2" class="pln"><span class="n"><a href="#t2">2</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3" class="run"><span class="n"><a href="#t3">3</a></span><span class="t"><span class="key">import</span> <span class="nam">time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t4" class="run"><span class="n"><a href="#t4">4</a></span><span class="t"><span class="key">import</span> <span class="nam">math</span>&nbsp;</span><span class="r"></span></p>
    <p id="t5" class="pln"><span class="n"><a href="#t5">5</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t6" class="run"><span class="n"><a href="#t6">6</a></span><span class="t"><span class="key">from</span> <span class="nam">odoo</span><span class="op">.</span><span class="nam">osv</span> <span class="key">import</span> <span class="nam">expression</span>&nbsp;</span><span class="r"></span></p>
    <p id="t7" class="run"><span class="n"><a href="#t7">7</a></span><span class="t"><span class="key">from</span> <span class="nam">odoo</span><span class="op">.</span><span class="nam">tools</span><span class="op">.</span><span class="nam">float_utils</span> <span class="key">import</span> <span class="nam">float_round</span> <span class="key">as</span> <span class="nam">round</span>&nbsp;</span><span class="r"></span></p>
    <p id="t8" class="run"><span class="n"><a href="#t8">8</a></span><span class="t"><span class="key">from</span> <span class="nam">odoo</span><span class="op">.</span><span class="nam">tools</span> <span class="key">import</span> <span class="nam">DEFAULT_SERVER_DATETIME_FORMAT</span>&nbsp;</span><span class="r"></span></p>
    <p id="t9" class="run"><span class="n"><a href="#t9">9</a></span><span class="t"><span class="key">from</span> <span class="nam">odoo</span><span class="op">.</span><span class="nam">exceptions</span> <span class="key">import</span> <span class="nam">UserError</span><span class="op">,</span> <span class="nam">ValidationError</span>&nbsp;</span><span class="r"></span></p>
    <p id="t10" class="run"><span class="n"><a href="#t10">10</a></span><span class="t"><span class="key">from</span> <span class="nam">odoo</span> <span class="key">import</span> <span class="nam">api</span><span class="op">,</span> <span class="nam">fields</span><span class="op">,</span> <span class="nam">models</span><span class="op">,</span> <span class="nam">_</span>&nbsp;</span><span class="r"></span></p>
    <p id="t11" class="pln"><span class="n"><a href="#t11">11</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t12" class="pln"><span class="n"><a href="#t12">12</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t13" class="run"><span class="n"><a href="#t13">13</a></span><span class="t"><span class="key">class</span> <span class="nam">AccountAccountType</span><span class="op">(</span><span class="nam">models</span><span class="op">.</span><span class="nam">Model</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t14" class="run"><span class="n"><a href="#t14">14</a></span><span class="t">    <span class="nam">_name</span> <span class="op">=</span> <span class="str">"account.account.type"</span>&nbsp;</span><span class="r"></span></p>
    <p id="t15" class="run"><span class="n"><a href="#t15">15</a></span><span class="t">    <span class="nam">_description</span> <span class="op">=</span> <span class="str">"Account Type"</span>&nbsp;</span><span class="r"></span></p>
    <p id="t16" class="pln"><span class="n"><a href="#t16">16</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t17" class="run"><span class="n"><a href="#t17">17</a></span><span class="t">    <span class="nam">name</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Char</span><span class="op">(</span><span class="nam">string</span><span class="op">=</span><span class="str">'Account Type'</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">translate</span><span class="op">=</span><span class="nam">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t18" class="run"><span class="n"><a href="#t18">18</a></span><span class="t">    <span class="nam">include_initial_balance</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Boolean</span><span class="op">(</span><span class="nam">string</span><span class="op">=</span><span class="str">"Bring Accounts Balance Forward"</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Used in reports to know if we should consider journal items from the beginning of time instead of from the fiscal year only. Account types that should be reset to zero at each new fiscal year (like expenses, revenue..) should not have this option set."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t19" class="run"><span class="n"><a href="#t19">19</a></span><span class="t">    <span class="nam">type</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Selection</span><span class="op">(</span><span class="op">[</span>&nbsp;</span><span class="r"></span></p>
    <p id="t20" class="pln"><span class="n"><a href="#t20">20</a></span><span class="t">        <span class="op">(</span><span class="str">'other'</span><span class="op">,</span> <span class="str">'Regular'</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t21" class="pln"><span class="n"><a href="#t21">21</a></span><span class="t">        <span class="op">(</span><span class="str">'receivable'</span><span class="op">,</span> <span class="str">'Receivable'</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t22" class="pln"><span class="n"><a href="#t22">22</a></span><span class="t">        <span class="op">(</span><span class="str">'payable'</span><span class="op">,</span> <span class="str">'Payable'</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t23" class="pln"><span class="n"><a href="#t23">23</a></span><span class="t">        <span class="op">(</span><span class="str">'liquidity'</span><span class="op">,</span> <span class="str">'Liquidity'</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t24" class="pln"><span class="n"><a href="#t24">24</a></span><span class="t">    <span class="op">]</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">'other'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t25" class="pln"><span class="n"><a href="#t25">25</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"The 'Internal Type' is used for features available on "</span><span class="xx">\</span>&nbsp;</span><span class="r"></span></p>
    <p id="t26" class="pln"><span class="n"><a href="#t26">26</a></span><span class="t">        <span class="str">"different types of accounts: liquidity type is for cash or bank accounts"</span><span class="xx">\</span>&nbsp;</span><span class="r"></span></p>
    <p id="t27" class="pln"><span class="n"><a href="#t27">27</a></span><span class="t">        <span class="str">", payable/receivable is for vendor/customer accounts."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t28" class="run"><span class="n"><a href="#t28">28</a></span><span class="t">    <span class="nam">note</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Text</span><span class="op">(</span><span class="nam">string</span><span class="op">=</span><span class="str">'Description'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t29" class="pln"><span class="n"><a href="#t29">29</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t30" class="pln"><span class="n"><a href="#t30">30</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t31" class="run"><span class="n"><a href="#t31">31</a></span><span class="t"><span class="key">class</span> <span class="nam">AccountAccountTag</span><span class="op">(</span><span class="nam">models</span><span class="op">.</span><span class="nam">Model</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t32" class="run"><span class="n"><a href="#t32">32</a></span><span class="t">    <span class="nam">_name</span> <span class="op">=</span> <span class="str">'account.account.tag'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t33" class="run"><span class="n"><a href="#t33">33</a></span><span class="t">    <span class="nam">_description</span> <span class="op">=</span> <span class="str">'Account Tag'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t34" class="pln"><span class="n"><a href="#t34">34</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t35" class="run"><span class="n"><a href="#t35">35</a></span><span class="t">    <span class="nam">name</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Char</span><span class="op">(</span><span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t36" class="run"><span class="n"><a href="#t36">36</a></span><span class="t">    <span class="nam">applicability</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Selection</span><span class="op">(</span><span class="op">[</span><span class="op">(</span><span class="str">'accounts'</span><span class="op">,</span> <span class="str">'Accounts'</span><span class="op">)</span><span class="op">,</span> <span class="op">(</span><span class="str">'taxes'</span><span class="op">,</span> <span class="str">'Taxes'</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">'accounts'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t37" class="run"><span class="n"><a href="#t37">37</a></span><span class="t">    <span class="nam">color</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Integer</span><span class="op">(</span><span class="str">'Color Index'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t38" class="pln"><span class="n"><a href="#t38">38</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t39" class="pln"><span class="n"><a href="#t39">39</a></span><span class="t"><span class="com">#----------------------------------------------------------</span>&nbsp;</span><span class="r"></span></p>
    <p id="t40" class="pln"><span class="n"><a href="#t40">40</a></span><span class="t"><span class="com"># Accounts</span>&nbsp;</span><span class="r"></span></p>
    <p id="t41" class="pln"><span class="n"><a href="#t41">41</a></span><span class="t"><span class="com">#----------------------------------------------------------</span>&nbsp;</span><span class="r"></span></p>
    <p id="t42" class="pln"><span class="n"><a href="#t42">42</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t43" class="pln"><span class="n"><a href="#t43">43</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t44" class="run"><span class="n"><a href="#t44">44</a></span><span class="t"><span class="key">class</span> <span class="nam">AccountAccount</span><span class="op">(</span><span class="nam">models</span><span class="op">.</span><span class="nam">Model</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t45" class="run"><span class="n"><a href="#t45">45</a></span><span class="t">    <span class="nam">_name</span> <span class="op">=</span> <span class="str">"account.account"</span>&nbsp;</span><span class="r"></span></p>
    <p id="t46" class="run"><span class="n"><a href="#t46">46</a></span><span class="t">    <span class="nam">_description</span> <span class="op">=</span> <span class="str">"Account"</span>&nbsp;</span><span class="r"></span></p>
    <p id="t47" class="run"><span class="n"><a href="#t47">47</a></span><span class="t">    <span class="nam">_order</span> <span class="op">=</span> <span class="str">"code"</span>&nbsp;</span><span class="r"></span></p>
    <p id="t48" class="pln"><span class="n"><a href="#t48">48</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t49" class="pln"><span class="n"><a href="#t49">49</a></span><span class="t">    <span class="com">#@api.multi</span>&nbsp;</span><span class="r"></span></p>
    <p id="t50" class="pln"><span class="n"><a href="#t50">50</a></span><span class="t">    <span class="com">#def _compute_has_unreconciled_entries(self):</span>&nbsp;</span><span class="r"></span></p>
    <p id="t51" class="pln"><span class="n"><a href="#t51">51</a></span><span class="t">    <span class="com">#    print "ici dedans"</span>&nbsp;</span><span class="r"></span></p>
    <p id="t52" class="pln"><span class="n"><a href="#t52">52</a></span><span class="t">    <span class="com">#    account_ids = self.ids</span>&nbsp;</span><span class="r"></span></p>
    <p id="t53" class="pln"><span class="n"><a href="#t53">53</a></span><span class="t">    <span class="com">#    for account in self:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t54" class="pln"><span class="n"><a href="#t54">54</a></span><span class="t">    <span class="com">#        # Avoid useless work if has_unreconciled_entries is not relevant for this account</span>&nbsp;</span><span class="r"></span></p>
    <p id="t55" class="pln"><span class="n"><a href="#t55">55</a></span><span class="t">    <span class="com">#        if account.deprecated or not account.reconcile:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t56" class="pln"><span class="n"><a href="#t56">56</a></span><span class="t">    <span class="com">#            account.has_unreconciled_entries = False</span>&nbsp;</span><span class="r"></span></p>
    <p id="t57" class="pln"><span class="n"><a href="#t57">57</a></span><span class="t">    <span class="com">#            account_ids = account_ids - account</span>&nbsp;</span><span class="r"></span></p>
    <p id="t58" class="pln"><span class="n"><a href="#t58">58</a></span><span class="t">    <span class="com">#    if account_ids:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t59" class="pln"><span class="n"><a href="#t59">59</a></span><span class="t">    <span class="com">#        res = dict.fromkeys([x.id for x in account_ids], False)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t60" class="pln"><span class="n"><a href="#t60">60</a></span><span class="t">    <span class="com">#        self.env.cr.execute(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t61" class="pln"><span class="n"><a href="#t61">61</a></span><span class="t">    <span class="com">#            """ SELECT s.account_id FROM(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t62" class="pln"><span class="n"><a href="#t62">62</a></span><span class="t">    <span class="com">#                    SELECT</span>&nbsp;</span><span class="r"></span></p>
    <p id="t63" class="pln"><span class="n"><a href="#t63">63</a></span><span class="t">    <span class="com">#                        a.id as account_id, a.last_time_entries_checked AS last_time_entries_checked,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t64" class="pln"><span class="n"><a href="#t64">64</a></span><span class="t">    <span class="com">#                        MAX(l.write_date) AS max_date</span>&nbsp;</span><span class="r"></span></p>
    <p id="t65" class="pln"><span class="n"><a href="#t65">65</a></span><span class="t">    <span class="com">#                    FROM</span>&nbsp;</span><span class="r"></span></p>
    <p id="t66" class="pln"><span class="n"><a href="#t66">66</a></span><span class="t">    <span class="com">#                        account_move_line l</span>&nbsp;</span><span class="r"></span></p>
    <p id="t67" class="pln"><span class="n"><a href="#t67">67</a></span><span class="t">    <span class="com">#                        RIGHT JOIN account_account a ON (a.id = l.account_id)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t68" class="pln"><span class="n"><a href="#t68">68</a></span><span class="t">    <span class="com">#                    WHERE</span>&nbsp;</span><span class="r"></span></p>
    <p id="t69" class="pln"><span class="n"><a href="#t69">69</a></span><span class="t">    <span class="com">#                        a.id in %s</span>&nbsp;</span><span class="r"></span></p>
    <p id="t70" class="pln"><span class="n"><a href="#t70">70</a></span><span class="t">    <span class="com">#                        AND EXISTS (</span>&nbsp;</span><span class="r"></span></p>
    <p id="t71" class="pln"><span class="n"><a href="#t71">71</a></span><span class="t">    <span class="com">#                            SELECT 1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t72" class="pln"><span class="n"><a href="#t72">72</a></span><span class="t">    <span class="com">#                            FROM account_move_line l</span>&nbsp;</span><span class="r"></span></p>
    <p id="t73" class="pln"><span class="n"><a href="#t73">73</a></span><span class="t">    <span class="com">#                            WHERE l.account_id = a.id</span>&nbsp;</span><span class="r"></span></p>
    <p id="t74" class="pln"><span class="n"><a href="#t74">74</a></span><span class="t">    <span class="com">#                            AND l.amount_residual > 0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t75" class="pln"><span class="n"><a href="#t75">75</a></span><span class="t">    <span class="com">#                        )</span>&nbsp;</span><span class="r"></span></p>
    <p id="t76" class="pln"><span class="n"><a href="#t76">76</a></span><span class="t">    <span class="com">#                        AND EXISTS (</span>&nbsp;</span><span class="r"></span></p>
    <p id="t77" class="pln"><span class="n"><a href="#t77">77</a></span><span class="t">    <span class="com">#                            SELECT 1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t78" class="pln"><span class="n"><a href="#t78">78</a></span><span class="t">    <span class="com">#                            FROM account_move_line l</span>&nbsp;</span><span class="r"></span></p>
    <p id="t79" class="pln"><span class="n"><a href="#t79">79</a></span><span class="t">    <span class="com">#                            WHERE l.account_id = a.id</span>&nbsp;</span><span class="r"></span></p>
    <p id="t80" class="pln"><span class="n"><a href="#t80">80</a></span><span class="t">    <span class="com">#                            AND l.amount_residual &lt; 0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t81" class="pln"><span class="n"><a href="#t81">81</a></span><span class="t">    <span class="com">#                        )</span>&nbsp;</span><span class="r"></span></p>
    <p id="t82" class="pln"><span class="n"><a href="#t82">82</a></span><span class="t">    <span class="com">#                    GROUP BY a.id, a.last_time_entries_checked</span>&nbsp;</span><span class="r"></span></p>
    <p id="t83" class="pln"><span class="n"><a href="#t83">83</a></span><span class="t">    <span class="com">#                ) as s</span>&nbsp;</span><span class="r"></span></p>
    <p id="t84" class="pln"><span class="n"><a href="#t84">84</a></span><span class="t">    <span class="com">#                WHERE (last_time_entries_checked IS NULL OR max_date > last_time_entries_checked)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t85" class="pln"><span class="n"><a href="#t85">85</a></span><span class="t">    <span class="com">#            """ % (account_ids,))</span>&nbsp;</span><span class="r"></span></p>
    <p id="t86" class="pln"><span class="n"><a href="#t86">86</a></span><span class="t">    <span class="com">#        res.update(self.env.cr.dictfetchall())</span>&nbsp;</span><span class="r"></span></p>
    <p id="t87" class="pln"><span class="n"><a href="#t87">87</a></span><span class="t">    <span class="com">#        for account in self.browse(res.keys()):</span>&nbsp;</span><span class="r"></span></p>
    <p id="t88" class="pln"><span class="n"><a href="#t88">88</a></span><span class="t">    <span class="com">#            if res[account.id]:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t89" class="pln"><span class="n"><a href="#t89">89</a></span><span class="t">    <span class="com">#                account.has_unreconciled_entries = True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t90" class="pln"><span class="n"><a href="#t90">90</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t91" class="run"><span class="n"><a href="#t91">91</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">multi</span>&nbsp;</span><span class="r"></span></p>
    <p id="t92" class="run"><span class="n"><a href="#t92">92</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">constrains</span><span class="op">(</span><span class="str">'internal_type'</span><span class="op">,</span> <span class="str">'reconcile'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t93" class="pln"><span class="n"><a href="#t93">93</a></span><span class="t">    <span class="key">def</span> <span class="nam">_check_reconcile</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t94" class="mis show_mis"><span class="n"><a href="#t94">94</a></span><span class="t">        <span class="key">for</span> <span class="nam">account</span> <span class="key">in</span> <span class="nam">self</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t95" class="mis show_mis"><span class="n"><a href="#t95">95</a></span><span class="t">            <span class="key">if</span> <span class="nam">account</span><span class="op">.</span><span class="nam">internal_type</span> <span class="key">in</span> <span class="op">(</span><span class="str">'receivable'</span><span class="op">,</span> <span class="str">'payable'</span><span class="op">)</span> <span class="key">and</span> <span class="nam">account</span><span class="op">.</span><span class="nam">reconcile</span> <span class="op">==</span> <span class="nam">False</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t96" class="mis show_mis"><span class="n"><a href="#t96">96</a></span><span class="t">                <span class="key">raise</span> <span class="nam">ValidationError</span><span class="op">(</span><span class="nam">_</span><span class="op">(</span><span class="str">'You cannot have a receivable/payable account that is not reconciliable. (account code: %s)'</span><span class="op">)</span> <span class="op">%</span> <span class="nam">account</span><span class="op">.</span><span class="nam">code</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t97" class="pln"><span class="n"><a href="#t97">97</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t98" class="run"><span class="n"><a href="#t98">98</a></span><span class="t">    <span class="nam">name</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Char</span><span class="op">(</span><span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">index</span><span class="op">=</span><span class="nam">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t99" class="run"><span class="n"><a href="#t99">99</a></span><span class="t">    <span class="nam">currency_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'res.currency'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Account Currency'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t100" class="pln"><span class="n"><a href="#t100">100</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"Forces all moves for this account to have this account currency."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t101" class="run"><span class="n"><a href="#t101">101</a></span><span class="t">    <span class="nam">code</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Char</span><span class="op">(</span><span class="nam">size</span><span class="op">=</span><span class="num">64</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">index</span><span class="op">=</span><span class="nam">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t102" class="run"><span class="n"><a href="#t102">102</a></span><span class="t">    <span class="nam">deprecated</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Boolean</span><span class="op">(</span><span class="nam">index</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t103" class="run"><span class="n"><a href="#t103">103</a></span><span class="t">    <span class="nam">user_type_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'account.account.type'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Type'</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">oldname</span><span class="op">=</span><span class="str">"user_type"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t104" class="pln"><span class="n"><a href="#t104">104</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"Account Type is used for information purpose, to generate country-specific legal reports, and set the rules to close a fiscal year and generate opening entries."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t105" class="run"><span class="n"><a href="#t105">105</a></span><span class="t">    <span class="nam">internal_type</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Selection</span><span class="op">(</span><span class="nam">related</span><span class="op">=</span><span class="str">'user_type_id.type'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">"Internal Type"</span><span class="op">,</span> <span class="nam">store</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">readonly</span><span class="op">=</span><span class="nam">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t106" class="pln"><span class="n"><a href="#t106">106</a></span><span class="t">    <span class="com">#has_unreconciled_entries = fields.Boolean(compute='_compute_has_unreconciled_entries',</span>&nbsp;</span><span class="r"></span></p>
    <p id="t107" class="pln"><span class="n"><a href="#t107">107</a></span><span class="t">    <span class="com">#    help="The account has at least one unreconciled debit and credit since last time the invoices &amp; payments matching was performed.")</span>&nbsp;</span><span class="r"></span></p>
    <p id="t108" class="run"><span class="n"><a href="#t108">108</a></span><span class="t">    <span class="nam">last_time_entries_checked</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Datetime</span><span class="op">(</span><span class="nam">string</span><span class="op">=</span><span class="str">'Latest Invoices &amp; Payments Matching Date'</span><span class="op">,</span> <span class="nam">readonly</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">copy</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t109" class="pln"><span class="n"><a href="#t109">109</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">'Last time the invoices &amp; payments matching was performed on this account. It is set either if there\'s not at least '</span><span class="xx">\</span>&nbsp;</span><span class="r"></span></p>
    <p id="t110" class="pln"><span class="n"><a href="#t110">110</a></span><span class="t">        <span class="str">'an unreconciled debit and an unreconciled credit Or if you click the "Done" button.'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t111" class="run"><span class="n"><a href="#t111">111</a></span><span class="t">    <span class="nam">reconcile</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Boolean</span><span class="op">(</span><span class="nam">string</span><span class="op">=</span><span class="str">'Allow Reconciliation'</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t112" class="pln"><span class="n"><a href="#t112">112</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"Check this box if this account allows invoices &amp; payments matching of journal items."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t113" class="run"><span class="n"><a href="#t113">113</a></span><span class="t">    <span class="nam">tax_ids</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2many</span><span class="op">(</span><span class="str">'account.tax'</span><span class="op">,</span> <span class="str">'account_account_tax_default_rel'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t114" class="pln"><span class="n"><a href="#t114">114</a></span><span class="t">        <span class="str">'account_id'</span><span class="op">,</span> <span class="str">'tax_id'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Default Taxes'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t115" class="run"><span class="n"><a href="#t115">115</a></span><span class="t">    <span class="nam">note</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Text</span><span class="op">(</span><span class="str">'Internal Notes'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t116" class="run"><span class="n"><a href="#t116">116</a></span><span class="t">    <span class="nam">company_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'res.company'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Company'</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t117" class="pln"><span class="n"><a href="#t117">117</a></span><span class="t">        <span class="nam">default</span><span class="op">=</span><span class="key">lambda</span> <span class="nam">self</span><span class="op">:</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'res.company'</span><span class="op">]</span><span class="op">.</span><span class="nam">_company_default_get</span><span class="op">(</span><span class="str">'account.account'</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t118" class="run"><span class="n"><a href="#t118">118</a></span><span class="t">    <span class="nam">tag_ids</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2many</span><span class="op">(</span><span class="str">'account.account.tag'</span><span class="op">,</span> <span class="str">'account_account_account_tag'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Tags'</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Optional tags you may want to assign for custom reporting"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t119" class="pln"><span class="n"><a href="#t119">119</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t120" class="run"><span class="n"><a href="#t120">120</a></span><span class="t">    <span class="nam">_sql_constraints</span> <span class="op">=</span> <span class="op">[</span>&nbsp;</span><span class="r"></span></p>
    <p id="t121" class="pln"><span class="n"><a href="#t121">121</a></span><span class="t">        <span class="op">(</span><span class="str">'code_company_uniq'</span><span class="op">,</span> <span class="str">'unique (code,company_id)'</span><span class="op">,</span> <span class="str">'The code of the account must be unique per company !'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t122" class="pln"><span class="n"><a href="#t122">122</a></span><span class="t">    <span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t123" class="pln"><span class="n"><a href="#t123">123</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t124" class="run"><span class="n"><a href="#t124">124</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">model</span>&nbsp;</span><span class="r"></span></p>
    <p id="t125" class="pln"><span class="n"><a href="#t125">125</a></span><span class="t">    <span class="key">def</span> <span class="nam">default_get</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">default_fields</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t126" class="pln"><span class="n"><a href="#t126">126</a></span><span class="t">        <span class="str">"""If we're creating a new account through a many2one, there are chances that we typed the account code</span>&nbsp;</span><span class="r"></span></p>
    <p id="t127" class="pln"><span class="n"><a href="#t127">127</a></span><span class="t"><span class="str">        instead of its name. In that case, switch both fields values.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t128" class="pln"><span class="n"><a href="#t128">128</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t129" class="mis show_mis"><span class="n"><a href="#t129">129</a></span><span class="t">        <span class="nam">default_name</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_context</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'default_name'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t130" class="mis show_mis"><span class="n"><a href="#t130">130</a></span><span class="t">        <span class="nam">default_code</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_context</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'default_code'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t131" class="mis show_mis"><span class="n"><a href="#t131">131</a></span><span class="t">        <span class="key">if</span> <span class="nam">default_name</span> <span class="key">and</span> <span class="key">not</span> <span class="nam">default_code</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t132" class="mis show_mis"><span class="n"><a href="#t132">132</a></span><span class="t">            <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t133" class="mis show_mis"><span class="n"><a href="#t133">133</a></span><span class="t">                <span class="nam">default_code</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">default_name</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t134" class="mis show_mis"><span class="n"><a href="#t134">134</a></span><span class="t">            <span class="key">except</span> <span class="nam">ValueError</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t135" class="mis show_mis"><span class="n"><a href="#t135">135</a></span><span class="t">                <span class="key">pass</span>&nbsp;</span><span class="r"></span></p>
    <p id="t136" class="mis show_mis"><span class="n"><a href="#t136">136</a></span><span class="t">            <span class="key">if</span> <span class="nam">default_code</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t137" class="mis show_mis"><span class="n"><a href="#t137">137</a></span><span class="t">                <span class="nam">default_name</span> <span class="op">=</span> <span class="nam">False</span>&nbsp;</span><span class="r"></span></p>
    <p id="t138" class="mis show_mis"><span class="n"><a href="#t138">138</a></span><span class="t">        <span class="nam">contextual_self</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">with_context</span><span class="op">(</span><span class="nam">default_name</span><span class="op">=</span><span class="nam">default_name</span><span class="op">,</span> <span class="nam">default_code</span><span class="op">=</span><span class="nam">default_code</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t139" class="mis show_mis"><span class="n"><a href="#t139">139</a></span><span class="t">        <span class="key">return</span> <span class="nam">super</span><span class="op">(</span><span class="nam">AccountAccount</span><span class="op">,</span> <span class="nam">contextual_self</span><span class="op">)</span><span class="op">.</span><span class="nam">default_get</span><span class="op">(</span><span class="nam">default_fields</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t140" class="pln"><span class="n"><a href="#t140">140</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t141" class="run"><span class="n"><a href="#t141">141</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">model</span>&nbsp;</span><span class="r"></span></p>
    <p id="t142" class="run"><span class="n"><a href="#t142">142</a></span><span class="t">    <span class="key">def</span> <span class="nam">name_search</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">name</span><span class="op">,</span> <span class="nam">args</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">operator</span><span class="op">=</span><span class="str">'ilike'</span><span class="op">,</span> <span class="nam">limit</span><span class="op">=</span><span class="num">100</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t143" class="mis show_mis"><span class="n"><a href="#t143">143</a></span><span class="t">        <span class="nam">args</span> <span class="op">=</span> <span class="nam">args</span> <span class="key">or</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t144" class="mis show_mis"><span class="n"><a href="#t144">144</a></span><span class="t">        <span class="nam">domain</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t145" class="mis show_mis"><span class="n"><a href="#t145">145</a></span><span class="t">        <span class="key">if</span> <span class="nam">name</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t146" class="mis show_mis"><span class="n"><a href="#t146">146</a></span><span class="t">            <span class="nam">domain</span> <span class="op">=</span> <span class="op">[</span><span class="str">'|'</span><span class="op">,</span> <span class="op">(</span><span class="str">'code'</span><span class="op">,</span> <span class="str">'=ilike'</span><span class="op">,</span> <span class="nam">name</span> <span class="op">+</span> <span class="str">'%'</span><span class="op">)</span><span class="op">,</span> <span class="op">(</span><span class="str">'name'</span><span class="op">,</span> <span class="nam">operator</span><span class="op">,</span> <span class="nam">name</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t147" class="mis show_mis"><span class="n"><a href="#t147">147</a></span><span class="t">            <span class="key">if</span> <span class="nam">operator</span> <span class="key">in</span> <span class="nam">expression</span><span class="op">.</span><span class="nam">NEGATIVE_TERM_OPERATORS</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t148" class="mis show_mis"><span class="n"><a href="#t148">148</a></span><span class="t">                <span class="nam">domain</span> <span class="op">=</span> <span class="op">[</span><span class="str">'&amp;'</span><span class="op">,</span> <span class="str">'!'</span><span class="op">]</span> <span class="op">+</span> <span class="nam">domain</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t149" class="mis show_mis"><span class="n"><a href="#t149">149</a></span><span class="t">        <span class="nam">accounts</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">search</span><span class="op">(</span><span class="nam">domain</span> <span class="op">+</span> <span class="nam">args</span><span class="op">,</span> <span class="nam">limit</span><span class="op">=</span><span class="nam">limit</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t150" class="mis show_mis"><span class="n"><a href="#t150">150</a></span><span class="t">        <span class="key">return</span> <span class="nam">accounts</span><span class="op">.</span><span class="nam">name_get</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t151" class="pln"><span class="n"><a href="#t151">151</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t152" class="run"><span class="n"><a href="#t152">152</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">onchange</span><span class="op">(</span><span class="str">'internal_type'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t153" class="pln"><span class="n"><a href="#t153">153</a></span><span class="t">    <span class="key">def</span> <span class="nam">onchange_internal_type</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t154" class="mis show_mis"><span class="n"><a href="#t154">154</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">internal_type</span> <span class="key">in</span> <span class="op">(</span><span class="str">'receivable'</span><span class="op">,</span> <span class="str">'payable'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t155" class="mis show_mis"><span class="n"><a href="#t155">155</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">reconcile</span> <span class="op">=</span> <span class="nam">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t156" class="mis show_mis"><span class="n"><a href="#t156">156</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">internal_type</span> <span class="op">==</span> <span class="str">'liquidity'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t157" class="mis show_mis"><span class="n"><a href="#t157">157</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">reconcile</span> <span class="op">=</span> <span class="nam">False</span>&nbsp;</span><span class="r"></span></p>
    <p id="t158" class="pln"><span class="n"><a href="#t158">158</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t159" class="run"><span class="n"><a href="#t159">159</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">multi</span>&nbsp;</span><span class="r"></span></p>
    <p id="t160" class="run"><span class="n"><a href="#t160">160</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">depends</span><span class="op">(</span><span class="str">'name'</span><span class="op">,</span> <span class="str">'code'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t161" class="pln"><span class="n"><a href="#t161">161</a></span><span class="t">    <span class="key">def</span> <span class="nam">name_get</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t162" class="mis show_mis"><span class="n"><a href="#t162">162</a></span><span class="t">        <span class="nam">result</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t163" class="mis show_mis"><span class="n"><a href="#t163">163</a></span><span class="t">        <span class="key">for</span> <span class="nam">account</span> <span class="key">in</span> <span class="nam">self</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t164" class="mis show_mis"><span class="n"><a href="#t164">164</a></span><span class="t">            <span class="nam">name</span> <span class="op">=</span> <span class="nam">account</span><span class="op">.</span><span class="nam">code</span> <span class="op">+</span> <span class="str">' '</span> <span class="op">+</span> <span class="nam">account</span><span class="op">.</span><span class="nam">name</span>&nbsp;</span><span class="r"></span></p>
    <p id="t165" class="mis show_mis"><span class="n"><a href="#t165">165</a></span><span class="t">            <span class="nam">result</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">(</span><span class="nam">account</span><span class="op">.</span><span class="nam">id</span><span class="op">,</span> <span class="nam">name</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t166" class="mis show_mis"><span class="n"><a href="#t166">166</a></span><span class="t">        <span class="key">return</span> <span class="nam">result</span>&nbsp;</span><span class="r"></span></p>
    <p id="t167" class="pln"><span class="n"><a href="#t167">167</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t168" class="run"><span class="n"><a href="#t168">168</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">one</span>&nbsp;</span><span class="r"></span></p>
    <p id="t169" class="run"><span class="n"><a href="#t169">169</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">returns</span><span class="op">(</span><span class="str">'self'</span><span class="op">,</span> <span class="key">lambda</span> <span class="nam">value</span><span class="op">:</span> <span class="nam">value</span><span class="op">.</span><span class="nam">id</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t170" class="run"><span class="n"><a href="#t170">170</a></span><span class="t">    <span class="key">def</span> <span class="nam">copy</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t171" class="mis show_mis"><span class="n"><a href="#t171">171</a></span><span class="t">        <span class="nam">default</span> <span class="op">=</span> <span class="nam">dict</span><span class="op">(</span><span class="nam">default</span> <span class="key">or</span> <span class="op">{</span><span class="op">}</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t172" class="mis show_mis"><span class="n"><a href="#t172">172</a></span><span class="t">        <span class="nam">default</span><span class="op">.</span><span class="nam">setdefault</span><span class="op">(</span><span class="str">'code'</span><span class="op">,</span> <span class="nam">_</span><span class="op">(</span><span class="str">"%s (copy)"</span><span class="op">)</span> <span class="op">%</span> <span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">code</span> <span class="key">or</span> <span class="str">''</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t173" class="mis show_mis"><span class="n"><a href="#t173">173</a></span><span class="t">        <span class="key">return</span> <span class="nam">super</span><span class="op">(</span><span class="nam">AccountAccount</span><span class="op">,</span> <span class="nam">self</span><span class="op">)</span><span class="op">.</span><span class="nam">copy</span><span class="op">(</span><span class="nam">default</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t174" class="pln"><span class="n"><a href="#t174">174</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t175" class="run"><span class="n"><a href="#t175">175</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">multi</span>&nbsp;</span><span class="r"></span></p>
    <p id="t176" class="pln"><span class="n"><a href="#t176">176</a></span><span class="t">    <span class="key">def</span> <span class="nam">write</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">vals</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t177" class="pln"><span class="n"><a href="#t177">177</a></span><span class="t">        <span class="com"># Dont allow changing the company_id when account_move_line already exist</span>&nbsp;</span><span class="r"></span></p>
    <p id="t178" class="mis show_mis"><span class="n"><a href="#t178">178</a></span><span class="t">        <span class="key">if</span> <span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'company_id'</span><span class="op">,</span> <span class="nam">False</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t179" class="mis show_mis"><span class="n"><a href="#t179">179</a></span><span class="t">            <span class="nam">move_lines</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'account.move.line'</span><span class="op">]</span><span class="op">.</span><span class="nam">search</span><span class="op">(</span><span class="op">[</span><span class="op">(</span><span class="str">'account_id'</span><span class="op">,</span> <span class="str">'in'</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">ids</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">limit</span><span class="op">=</span><span class="num">1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t180" class="mis show_mis"><span class="n"><a href="#t180">180</a></span><span class="t">            <span class="key">for</span> <span class="nam">account</span> <span class="key">in</span> <span class="nam">self</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t181" class="mis show_mis"><span class="n"><a href="#t181">181</a></span><span class="t">                <span class="key">if</span> <span class="op">(</span><span class="nam">account</span><span class="op">.</span><span class="nam">company_id</span><span class="op">.</span><span class="nam">id</span> <span class="op">&lt;></span> <span class="nam">vals</span><span class="op">[</span><span class="str">'company_id'</span><span class="op">]</span><span class="op">)</span> <span class="key">and</span> <span class="nam">move_lines</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t182" class="mis show_mis"><span class="n"><a href="#t182">182</a></span><span class="t">                    <span class="key">raise</span> <span class="nam">UserError</span><span class="op">(</span><span class="nam">_</span><span class="op">(</span><span class="str">'You cannot change the owner company of an account that already contains journal items.'</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t183" class="pln"><span class="n"><a href="#t183">183</a></span><span class="t">        <span class="com"># If user change the reconcile flag, all aml should be recomputed for that account and this is very costly.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t184" class="pln"><span class="n"><a href="#t184">184</a></span><span class="t">        <span class="com"># So to prevent some bugs we add a constraint saying that you cannot change the reconcile field if there is any aml existing</span>&nbsp;</span><span class="r"></span></p>
    <p id="t185" class="pln"><span class="n"><a href="#t185">185</a></span><span class="t">        <span class="com"># for that account.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t186" class="mis show_mis"><span class="n"><a href="#t186">186</a></span><span class="t">        <span class="key">if</span> <span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'reconcile'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t187" class="mis show_mis"><span class="n"><a href="#t187">187</a></span><span class="t">            <span class="nam">move_lines</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'account.move.line'</span><span class="op">]</span><span class="op">.</span><span class="nam">search</span><span class="op">(</span><span class="op">[</span><span class="op">(</span><span class="str">'account_id'</span><span class="op">,</span> <span class="str">'in'</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">ids</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">limit</span><span class="op">=</span><span class="num">1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t188" class="mis show_mis"><span class="n"><a href="#t188">188</a></span><span class="t">            <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">move_lines</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t189" class="mis show_mis"><span class="n"><a href="#t189">189</a></span><span class="t">                <span class="key">raise</span> <span class="nam">UserError</span><span class="op">(</span><span class="nam">_</span><span class="op">(</span><span class="str">'You cannot change the value of the reconciliation on this account as it already has some moves'</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t190" class="pln"><span class="n"><a href="#t190">190</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t191" class="mis show_mis"><span class="n"><a href="#t191">191</a></span><span class="t">        <span class="key">if</span> <span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'currency_id'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t192" class="mis show_mis"><span class="n"><a href="#t192">192</a></span><span class="t">            <span class="key">for</span> <span class="nam">account</span> <span class="key">in</span> <span class="nam">self</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t193" class="mis show_mis"><span class="n"><a href="#t193">193</a></span><span class="t">                <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'account.move.line'</span><span class="op">]</span><span class="op">.</span><span class="nam">search_count</span><span class="op">(</span><span class="op">[</span><span class="op">(</span><span class="str">'account_id'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="nam">account</span><span class="op">.</span><span class="nam">id</span><span class="op">)</span><span class="op">,</span> <span class="op">(</span><span class="str">'currency_id'</span><span class="op">,</span> <span class="str">'not in'</span><span class="op">,</span> <span class="op">(</span><span class="nam">False</span><span class="op">,</span> <span class="nam">vals</span><span class="op">[</span><span class="str">'currency_id'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t194" class="mis show_mis"><span class="n"><a href="#t194">194</a></span><span class="t">                    <span class="key">raise</span> <span class="nam">UserError</span><span class="op">(</span><span class="nam">_</span><span class="op">(</span><span class="str">'You cannot set a currency on this account as it already has some journal entries having a different foreign currency.'</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t195" class="pln"><span class="n"><a href="#t195">195</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t196" class="mis show_mis"><span class="n"><a href="#t196">196</a></span><span class="t">        <span class="key">return</span> <span class="nam">super</span><span class="op">(</span><span class="nam">AccountAccount</span><span class="op">,</span> <span class="nam">self</span><span class="op">)</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="nam">vals</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t197" class="pln"><span class="n"><a href="#t197">197</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t198" class="run"><span class="n"><a href="#t198">198</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">multi</span>&nbsp;</span><span class="r"></span></p>
    <p id="t199" class="pln"><span class="n"><a href="#t199">199</a></span><span class="t">    <span class="key">def</span> <span class="nam">unlink</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t200" class="mis show_mis"><span class="n"><a href="#t200">200</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'account.move.line'</span><span class="op">]</span><span class="op">.</span><span class="nam">search</span><span class="op">(</span><span class="op">[</span><span class="op">(</span><span class="str">'account_id'</span><span class="op">,</span> <span class="str">'in'</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">ids</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">limit</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t201" class="mis show_mis"><span class="n"><a href="#t201">201</a></span><span class="t">            <span class="key">raise</span> <span class="nam">UserError</span><span class="op">(</span><span class="nam">_</span><span class="op">(</span><span class="str">'You cannot do that on an account that contains journal items.'</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t202" class="pln"><span class="n"><a href="#t202">202</a></span><span class="t">        <span class="com">#Checking whether the account is set as a property to any Partner or not</span>&nbsp;</span><span class="r"></span></p>
    <p id="t203" class="mis show_mis"><span class="n"><a href="#t203">203</a></span><span class="t">        <span class="nam">values</span> <span class="op">=</span> <span class="op">[</span><span class="str">'account.account,%s'</span> <span class="op">%</span> <span class="op">(</span><span class="nam">account_id</span><span class="op">,</span><span class="op">)</span> <span class="key">for</span> <span class="nam">account_id</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">ids</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t204" class="mis show_mis"><span class="n"><a href="#t204">204</a></span><span class="t">        <span class="nam">partner_prop_acc</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'ir.property'</span><span class="op">]</span><span class="op">.</span><span class="nam">search</span><span class="op">(</span><span class="op">[</span><span class="op">(</span><span class="str">'value_reference'</span><span class="op">,</span> <span class="str">'in'</span><span class="op">,</span> <span class="nam">values</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">limit</span><span class="op">=</span><span class="num">1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t205" class="mis show_mis"><span class="n"><a href="#t205">205</a></span><span class="t">        <span class="key">if</span> <span class="nam">partner_prop_acc</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t206" class="mis show_mis"><span class="n"><a href="#t206">206</a></span><span class="t">            <span class="key">raise</span> <span class="nam">UserError</span><span class="op">(</span><span class="nam">_</span><span class="op">(</span><span class="str">'You cannot remove/deactivate an account which is set on a customer or vendor.'</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t207" class="mis show_mis"><span class="n"><a href="#t207">207</a></span><span class="t">        <span class="key">return</span> <span class="nam">super</span><span class="op">(</span><span class="nam">AccountAccount</span><span class="op">,</span> <span class="nam">self</span><span class="op">)</span><span class="op">.</span><span class="nam">unlink</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t208" class="pln"><span class="n"><a href="#t208">208</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t209" class="run"><span class="n"><a href="#t209">209</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">multi</span>&nbsp;</span><span class="r"></span></p>
    <p id="t210" class="pln"><span class="n"><a href="#t210">210</a></span><span class="t">    <span class="key">def</span> <span class="nam">mark_as_reconciled</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t211" class="mis show_mis"><span class="n"><a href="#t211">211</a></span><span class="t">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="op">{</span><span class="str">'last_time_entries_checked'</span><span class="op">:</span> <span class="nam">time</span><span class="op">.</span><span class="nam">strftime</span><span class="op">(</span><span class="nam">DEFAULT_SERVER_DATETIME_FORMAT</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t212" class="pln"><span class="n"><a href="#t212">212</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t213" class="run"><span class="n"><a href="#t213">213</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">multi</span>&nbsp;</span><span class="r"></span></p>
    <p id="t214" class="pln"><span class="n"><a href="#t214">214</a></span><span class="t">    <span class="key">def</span> <span class="nam">action_open_reconcile</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t215" class="mis show_mis"><span class="n"><a href="#t215">215</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">ensure_one</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t216" class="pln"><span class="n"><a href="#t216">216</a></span><span class="t">        <span class="com"># Open reconciliation view for this account</span>&nbsp;</span><span class="r"></span></p>
    <p id="t217" class="mis show_mis"><span class="n"><a href="#t217">217</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">internal_type</span> <span class="op">==</span> <span class="str">'payable'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t218" class="mis show_mis"><span class="n"><a href="#t218">218</a></span><span class="t">            <span class="nam">action_context</span> <span class="op">=</span> <span class="op">{</span><span class="str">'show_mode_selector'</span><span class="op">:</span> <span class="nam">False</span><span class="op">,</span> <span class="str">'mode'</span><span class="op">:</span> <span class="str">'suppliers'</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t219" class="mis show_mis"><span class="n"><a href="#t219">219</a></span><span class="t">        <span class="key">elif</span> <span class="nam">self</span><span class="op">.</span><span class="nam">internal_type</span> <span class="op">==</span> <span class="str">'receivable'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t220" class="mis show_mis"><span class="n"><a href="#t220">220</a></span><span class="t">            <span class="nam">action_context</span> <span class="op">=</span> <span class="op">{</span><span class="str">'show_mode_selector'</span><span class="op">:</span> <span class="nam">False</span><span class="op">,</span> <span class="str">'mode'</span><span class="op">:</span> <span class="str">'customers'</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t221" class="pln"><span class="n"><a href="#t221">221</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t222" class="mis show_mis"><span class="n"><a href="#t222">222</a></span><span class="t">            <span class="nam">action_context</span> <span class="op">=</span> <span class="op">{</span><span class="str">'show_mode_selector'</span><span class="op">:</span> <span class="nam">False</span><span class="op">,</span> <span class="str">'account_ids'</span><span class="op">:</span> <span class="op">[</span><span class="nam">self</span><span class="op">.</span><span class="nam">id</span><span class="op">,</span><span class="op">]</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t223" class="mis show_mis"><span class="n"><a href="#t223">223</a></span><span class="t">        <span class="key">return</span> <span class="op">{</span>&nbsp;</span><span class="r"></span></p>
    <p id="t224" class="pln"><span class="n"><a href="#t224">224</a></span><span class="t">            <span class="str">'type'</span><span class="op">:</span> <span class="str">'ir.actions.client'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t225" class="pln"><span class="n"><a href="#t225">225</a></span><span class="t">            <span class="str">'tag'</span><span class="op">:</span> <span class="str">'manual_reconciliation_view'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t226" class="pln"><span class="n"><a href="#t226">226</a></span><span class="t">            <span class="str">'context'</span><span class="op">:</span> <span class="nam">action_context</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t227" class="pln"><span class="n"><a href="#t227">227</a></span><span class="t">        <span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t228" class="pln"><span class="n"><a href="#t228">228</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t229" class="pln"><span class="n"><a href="#t229">229</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t230" class="run"><span class="n"><a href="#t230">230</a></span><span class="t"><span class="key">class</span> <span class="nam">AccountJournal</span><span class="op">(</span><span class="nam">models</span><span class="op">.</span><span class="nam">Model</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t231" class="run"><span class="n"><a href="#t231">231</a></span><span class="t">    <span class="nam">_name</span> <span class="op">=</span> <span class="str">"account.journal"</span>&nbsp;</span><span class="r"></span></p>
    <p id="t232" class="run"><span class="n"><a href="#t232">232</a></span><span class="t">    <span class="nam">_description</span> <span class="op">=</span> <span class="str">"Journal"</span>&nbsp;</span><span class="r"></span></p>
    <p id="t233" class="run"><span class="n"><a href="#t233">233</a></span><span class="t">    <span class="nam">_order</span> <span class="op">=</span> <span class="str">'sequence, type, code'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t234" class="pln"><span class="n"><a href="#t234">234</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t235" class="run"><span class="n"><a href="#t235">235</a></span><span class="t">    <span class="key">def</span> <span class="nam">_default_inbound_payment_methods</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t236" class="run"><span class="n"><a href="#t236">236</a></span><span class="t">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">ref</span><span class="op">(</span><span class="str">'account.account_payment_method_manual_in'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t237" class="pln"><span class="n"><a href="#t237">237</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t238" class="run"><span class="n"><a href="#t238">238</a></span><span class="t">    <span class="key">def</span> <span class="nam">_default_outbound_payment_methods</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t239" class="run"><span class="n"><a href="#t239">239</a></span><span class="t">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">ref</span><span class="op">(</span><span class="str">'account.account_payment_method_manual_out'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t240" class="pln"><span class="n"><a href="#t240">240</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t241" class="run"><span class="n"><a href="#t241">241</a></span><span class="t">    <span class="nam">name</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Char</span><span class="op">(</span><span class="nam">string</span><span class="op">=</span><span class="str">'Journal Name'</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t242" class="run"><span class="n"><a href="#t242">242</a></span><span class="t">    <span class="nam">code</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Char</span><span class="op">(</span><span class="nam">string</span><span class="op">=</span><span class="str">'Short Code'</span><span class="op">,</span> <span class="nam">size</span><span class="op">=</span><span class="num">5</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"The journal entries of this journal will be named using this prefix."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t243" class="run"><span class="n"><a href="#t243">243</a></span><span class="t">    <span class="nam">type</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Selection</span><span class="op">(</span><span class="op">[</span>&nbsp;</span><span class="r"></span></p>
    <p id="t244" class="pln"><span class="n"><a href="#t244">244</a></span><span class="t">            <span class="op">(</span><span class="str">'sale'</span><span class="op">,</span> <span class="str">'Sale'</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t245" class="pln"><span class="n"><a href="#t245">245</a></span><span class="t">            <span class="op">(</span><span class="str">'purchase'</span><span class="op">,</span> <span class="str">'Purchase'</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t246" class="pln"><span class="n"><a href="#t246">246</a></span><span class="t">            <span class="op">(</span><span class="str">'cash'</span><span class="op">,</span> <span class="str">'Cash'</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t247" class="pln"><span class="n"><a href="#t247">247</a></span><span class="t">            <span class="op">(</span><span class="str">'bank'</span><span class="op">,</span> <span class="str">'Bank'</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t248" class="pln"><span class="n"><a href="#t248">248</a></span><span class="t">            <span class="op">(</span><span class="str">'general'</span><span class="op">,</span> <span class="str">'Miscellaneous'</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t249" class="pln"><span class="n"><a href="#t249">249</a></span><span class="t">        <span class="op">]</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t250" class="pln"><span class="n"><a href="#t250">250</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"Select 'Sale' for customer invoices journals.\n"</span><span class="xx">\</span>&nbsp;</span><span class="r"></span></p>
    <p id="t251" class="pln"><span class="n"><a href="#t251">251</a></span><span class="t">        <span class="str">"Select 'Purchase' for vendor bills journals.\n"</span><span class="xx">\</span>&nbsp;</span><span class="r"></span></p>
    <p id="t252" class="pln"><span class="n"><a href="#t252">252</a></span><span class="t">        <span class="str">"Select 'Cash' or 'Bank' for journals that are used in customer or vendor payments.\n"</span><span class="xx">\</span>&nbsp;</span><span class="r"></span></p>
    <p id="t253" class="pln"><span class="n"><a href="#t253">253</a></span><span class="t">        <span class="str">"Select 'General' for miscellaneous operations journals."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t254" class="run"><span class="n"><a href="#t254">254</a></span><span class="t">    <span class="nam">type_control_ids</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2many</span><span class="op">(</span><span class="str">'account.account.type'</span><span class="op">,</span> <span class="str">'account_journal_type_rel'</span><span class="op">,</span> <span class="str">'journal_id'</span><span class="op">,</span> <span class="str">'type_id'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Account Types Allowed'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t255" class="run"><span class="n"><a href="#t255">255</a></span><span class="t">    <span class="nam">account_control_ids</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2many</span><span class="op">(</span><span class="str">'account.account'</span><span class="op">,</span> <span class="str">'account_account_type_rel'</span><span class="op">,</span> <span class="str">'journal_id'</span><span class="op">,</span> <span class="str">'account_id'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Accounts Allowed'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t256" class="pln"><span class="n"><a href="#t256">256</a></span><span class="t">        <span class="nam">domain</span><span class="op">=</span><span class="op">[</span><span class="op">(</span><span class="str">'deprecated'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="nam">False</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t257" class="run"><span class="n"><a href="#t257">257</a></span><span class="t">    <span class="nam">default_credit_account_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'account.account'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Default Credit Account'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t258" class="pln"><span class="n"><a href="#t258">258</a></span><span class="t">        <span class="nam">domain</span><span class="op">=</span><span class="op">[</span><span class="op">(</span><span class="str">'deprecated'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="nam">False</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"It acts as a default account for credit amount"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t259" class="run"><span class="n"><a href="#t259">259</a></span><span class="t">    <span class="nam">default_debit_account_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'account.account'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Default Debit Account'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t260" class="pln"><span class="n"><a href="#t260">260</a></span><span class="t">        <span class="nam">domain</span><span class="op">=</span><span class="op">[</span><span class="op">(</span><span class="str">'deprecated'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="nam">False</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"It acts as a default account for debit amount"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t261" class="run"><span class="n"><a href="#t261">261</a></span><span class="t">    <span class="nam">update_posted</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Boolean</span><span class="op">(</span><span class="nam">string</span><span class="op">=</span><span class="str">'Allow Cancelling Entries'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t262" class="pln"><span class="n"><a href="#t262">262</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"Check this box if you want to allow the cancellation the entries related to this journal or of the invoice related to this journal"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t263" class="run"><span class="n"><a href="#t263">263</a></span><span class="t">    <span class="nam">group_invoice_lines</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Boolean</span><span class="op">(</span><span class="nam">string</span><span class="op">=</span><span class="str">'Group Invoice Lines'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t264" class="pln"><span class="n"><a href="#t264">264</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"If this box is checked, the system will try to group the accounting lines when generating them from invoices."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t265" class="run"><span class="n"><a href="#t265">265</a></span><span class="t">    <span class="nam">sequence_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'ir.sequence'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Entry Sequence'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t266" class="pln"><span class="n"><a href="#t266">266</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"This field contains the information related to the numbering of the journal entries of this journal."</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">copy</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t267" class="run"><span class="n"><a href="#t267">267</a></span><span class="t">    <span class="nam">refund_sequence_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'ir.sequence'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Refund Entry Sequence'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t268" class="pln"><span class="n"><a href="#t268">268</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"This field contains the information related to the numbering of the refund entries of this journal."</span><span class="op">,</span> <span class="nam">copy</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t269" class="run"><span class="n"><a href="#t269">269</a></span><span class="t">    <span class="nam">sequence</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Integer</span><span class="op">(</span><span class="nam">help</span><span class="op">=</span><span class="str">'Used to order Journals in the dashboard view'</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">10</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t270" class="pln"><span class="n"><a href="#t270">270</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t271" class="pln"><span class="n"><a href="#t271">271</a></span><span class="t">    <span class="com">#groups_id = fields.Many2many('res.groups', 'account_journal_group_rel', 'journal_id', 'group_id', string='Groups')</span>&nbsp;</span><span class="r"></span></p>
    <p id="t272" class="run"><span class="n"><a href="#t272">272</a></span><span class="t">    <span class="nam">currency_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'res.currency'</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">'The currency used to enter statement'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">"Currency"</span><span class="op">,</span> <span class="nam">oldname</span><span class="op">=</span><span class="str">'currency'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t273" class="run"><span class="n"><a href="#t273">273</a></span><span class="t">    <span class="nam">company_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'res.company'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Company'</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">index</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="key">lambda</span> <span class="nam">self</span><span class="op">:</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">user</span><span class="op">.</span><span class="nam">company_id</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t274" class="pln"><span class="n"><a href="#t274">274</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"Company related to this journal"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t275" class="pln"><span class="n"><a href="#t275">275</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t276" class="run"><span class="n"><a href="#t276">276</a></span><span class="t">    <span class="nam">refund_sequence</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Boolean</span><span class="op">(</span><span class="nam">string</span><span class="op">=</span><span class="str">'Dedicated Refund Sequence'</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Check this box if you don't want to share the same sequence for invoices and refunds made from this journal"</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t277" class="pln"><span class="n"><a href="#t277">277</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t278" class="run"><span class="n"><a href="#t278">278</a></span><span class="t">    <span class="nam">inbound_payment_method_ids</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2many</span><span class="op">(</span><span class="str">'account.payment.method'</span><span class="op">,</span> <span class="str">'account_journal_inbound_payment_method_rel'</span><span class="op">,</span> <span class="str">'journal_id'</span><span class="op">,</span> <span class="str">'inbound_payment_method'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t279" class="pln"><span class="n"><a href="#t279">279</a></span><span class="t">        <span class="nam">domain</span><span class="op">=</span><span class="op">[</span><span class="op">(</span><span class="str">'payment_type'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="str">'inbound'</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Debit Methods'</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="key">lambda</span> <span class="nam">self</span><span class="op">:</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_default_inbound_payment_methods</span><span class="op">(</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t280" class="pln"><span class="n"><a href="#t280">280</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"Means of payment for collecting money. Odoo modules offer various payments handling facilities, "</span>&nbsp;</span><span class="r"></span></p>
    <p id="t281" class="pln"><span class="n"><a href="#t281">281</a></span><span class="t">             <span class="str">"but you can always use the 'Manual' payment method in order to manage payments outside of the software."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t282" class="run"><span class="n"><a href="#t282">282</a></span><span class="t">    <span class="nam">outbound_payment_method_ids</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2many</span><span class="op">(</span><span class="str">'account.payment.method'</span><span class="op">,</span> <span class="str">'account_journal_outbound_payment_method_rel'</span><span class="op">,</span> <span class="str">'journal_id'</span><span class="op">,</span> <span class="str">'outbound_payment_method'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t283" class="pln"><span class="n"><a href="#t283">283</a></span><span class="t">        <span class="nam">domain</span><span class="op">=</span><span class="op">[</span><span class="op">(</span><span class="str">'payment_type'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="str">'outbound'</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Payment Methods'</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="key">lambda</span> <span class="nam">self</span><span class="op">:</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_default_outbound_payment_methods</span><span class="op">(</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t284" class="pln"><span class="n"><a href="#t284">284</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"Means of payment for sending money. Odoo modules offer various payments handling facilities, "</span>&nbsp;</span><span class="r"></span></p>
    <p id="t285" class="pln"><span class="n"><a href="#t285">285</a></span><span class="t">             <span class="str">"but you can always use the 'Manual' payment method in order to manage payments outside of the software."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t286" class="run"><span class="n"><a href="#t286">286</a></span><span class="t">    <span class="nam">at_least_one_inbound</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Boolean</span><span class="op">(</span><span class="nam">compute</span><span class="op">=</span><span class="str">'_methods_compute'</span><span class="op">,</span> <span class="nam">store</span><span class="op">=</span><span class="nam">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t287" class="run"><span class="n"><a href="#t287">287</a></span><span class="t">    <span class="nam">at_least_one_outbound</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Boolean</span><span class="op">(</span><span class="nam">compute</span><span class="op">=</span><span class="str">'_methods_compute'</span><span class="op">,</span> <span class="nam">store</span><span class="op">=</span><span class="nam">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t288" class="run"><span class="n"><a href="#t288">288</a></span><span class="t">    <span class="nam">profit_account_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'account.account'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Profit Account'</span><span class="op">,</span> <span class="nam">domain</span><span class="op">=</span><span class="op">[</span><span class="op">(</span><span class="str">'deprecated'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="nam">False</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Used to register a profit when the ending balance of a cash register differs from what the system computes"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t289" class="run"><span class="n"><a href="#t289">289</a></span><span class="t">    <span class="nam">loss_account_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'account.account'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Loss Account'</span><span class="op">,</span> <span class="nam">domain</span><span class="op">=</span><span class="op">[</span><span class="op">(</span><span class="str">'deprecated'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="nam">False</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Used to register a loss when the ending balance of a cash register differs from what the system computes"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t290" class="pln"><span class="n"><a href="#t290">290</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t291" class="run"><span class="n"><a href="#t291">291</a></span><span class="t">    <span class="nam">belongs_to_company</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Boolean</span><span class="op">(</span><span class="str">'Belong to the user\'s current company'</span><span class="op">,</span> <span class="nam">compute</span><span class="op">=</span><span class="str">"_belong_to_company"</span><span class="op">,</span> <span class="nam">search</span><span class="op">=</span><span class="str">"_search_company_journals"</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t292" class="pln"><span class="n"><a href="#t292">292</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t293" class="pln"><span class="n"><a href="#t293">293</a></span><span class="t">    <span class="com"># Bank journals fields</span>&nbsp;</span><span class="r"></span></p>
    <p id="t294" class="run"><span class="n"><a href="#t294">294</a></span><span class="t">    <span class="nam">bank_account_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'res.partner.bank'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">"Bank Account"</span><span class="op">,</span> <span class="nam">ondelete</span><span class="op">=</span><span class="str">'restrict'</span><span class="op">,</span> <span class="nam">copy</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t295" class="run"><span class="n"><a href="#t295">295</a></span><span class="t">    <span class="nam">display_on_footer</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Boolean</span><span class="op">(</span><span class="str">"Show in Invoices Footer"</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Display this bank account on the footer of printed documents like invoices and sales orders."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t296" class="run"><span class="n"><a href="#t296">296</a></span><span class="t">    <span class="nam">bank_statements_source</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Selection</span><span class="op">(</span><span class="op">[</span><span class="op">(</span><span class="str">'manual'</span><span class="op">,</span> <span class="str">'Record Manually'</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Bank Feeds'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t297" class="run"><span class="n"><a href="#t297">297</a></span><span class="t">    <span class="nam">bank_acc_number</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Char</span><span class="op">(</span><span class="nam">related</span><span class="op">=</span><span class="str">'bank_account_id.acc_number'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t298" class="run"><span class="n"><a href="#t298">298</a></span><span class="t">    <span class="nam">bank_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'res.bank'</span><span class="op">,</span> <span class="nam">related</span><span class="op">=</span><span class="str">'bank_account_id.bank_id'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t299" class="pln"><span class="n"><a href="#t299">299</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t300" class="run"><span class="n"><a href="#t300">300</a></span><span class="t">    <span class="nam">_sql_constraints</span> <span class="op">=</span> <span class="op">[</span>&nbsp;</span><span class="r"></span></p>
    <p id="t301" class="pln"><span class="n"><a href="#t301">301</a></span><span class="t">        <span class="op">(</span><span class="str">'code_company_uniq'</span><span class="op">,</span> <span class="str">'unique (code, name, company_id)'</span><span class="op">,</span> <span class="str">'The code and name of the journal must be unique per company !'</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t302" class="pln"><span class="n"><a href="#t302">302</a></span><span class="t">    <span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t303" class="pln"><span class="n"><a href="#t303">303</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t304" class="run"><span class="n"><a href="#t304">304</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">one</span>&nbsp;</span><span class="r"></span></p>
    <p id="t305" class="run"><span class="n"><a href="#t305">305</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">constrains</span><span class="op">(</span><span class="str">'currency_id'</span><span class="op">,</span> <span class="str">'default_credit_account_id'</span><span class="op">,</span> <span class="str">'default_debit_account_id'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t306" class="pln"><span class="n"><a href="#t306">306</a></span><span class="t">    <span class="key">def</span> <span class="nam">_check_currency</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t307" class="mis show_mis"><span class="n"><a href="#t307">307</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">currency_id</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t308" class="mis show_mis"><span class="n"><a href="#t308">308</a></span><span class="t">            <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">currency_id</span> <span class="op">==</span> <span class="nam">self</span><span class="op">.</span><span class="nam">company_id</span><span class="op">.</span><span class="nam">currency_id</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t309" class="mis show_mis"><span class="n"><a href="#t309">309</a></span><span class="t">                <span class="key">raise</span> <span class="nam">ValidationError</span><span class="op">(</span><span class="nam">_</span><span class="op">(</span><span class="str">"Currency field should only be set if the journal's currency is different from the company's. Leave the field blank to use company currency."</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t310" class="mis show_mis"><span class="n"><a href="#t310">310</a></span><span class="t">            <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">default_credit_account_id</span> <span class="key">and</span> <span class="key">not</span> <span class="nam">self</span><span class="op">.</span><span class="nam">default_credit_account_id</span><span class="op">.</span><span class="nam">currency_id</span><span class="op">.</span><span class="nam">id</span> <span class="op">==</span> <span class="nam">self</span><span class="op">.</span><span class="nam">currency_id</span><span class="op">.</span><span class="nam">id</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t311" class="mis show_mis"><span class="n"><a href="#t311">311</a></span><span class="t">                <span class="key">raise</span> <span class="nam">ValidationError</span><span class="op">(</span><span class="nam">_</span><span class="op">(</span><span class="str">'Configuration error!\nThe currency of the journal should be the same than the default credit account.'</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t312" class="mis show_mis"><span class="n"><a href="#t312">312</a></span><span class="t">            <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">default_debit_account_id</span> <span class="key">and</span> <span class="key">not</span> <span class="nam">self</span><span class="op">.</span><span class="nam">default_debit_account_id</span><span class="op">.</span><span class="nam">currency_id</span><span class="op">.</span><span class="nam">id</span> <span class="op">==</span> <span class="nam">self</span><span class="op">.</span><span class="nam">currency_id</span><span class="op">.</span><span class="nam">id</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t313" class="mis show_mis"><span class="n"><a href="#t313">313</a></span><span class="t">                <span class="key">raise</span> <span class="nam">ValidationError</span><span class="op">(</span><span class="nam">_</span><span class="op">(</span><span class="str">'Configuration error!\nThe currency of the journal should be the same than the default debit account.'</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t314" class="pln"><span class="n"><a href="#t314">314</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t315" class="run"><span class="n"><a href="#t315">315</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">one</span>&nbsp;</span><span class="r"></span></p>
    <p id="t316" class="run"><span class="n"><a href="#t316">316</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">constrains</span><span class="op">(</span><span class="str">'type'</span><span class="op">,</span> <span class="str">'bank_account_id'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t317" class="pln"><span class="n"><a href="#t317">317</a></span><span class="t">    <span class="key">def</span> <span class="nam">_check_bank_account</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t318" class="run"><span class="n"><a href="#t318">318</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'bank'</span> <span class="key">and</span> <span class="nam">self</span><span class="op">.</span><span class="nam">bank_account_id</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t319" class="mis show_mis"><span class="n"><a href="#t319">319</a></span><span class="t">            <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">bank_account_id</span><span class="op">.</span><span class="nam">company_id</span> <span class="op">!=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">company_id</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t320" class="mis show_mis"><span class="n"><a href="#t320">320</a></span><span class="t">                <span class="key">raise</span> <span class="nam">ValidationError</span><span class="op">(</span><span class="nam">_</span><span class="op">(</span><span class="str">'The bank account of a bank journal must belong to the same company (%s).'</span><span class="op">)</span> <span class="op">%</span> <span class="nam">self</span><span class="op">.</span><span class="nam">company_id</span><span class="op">.</span><span class="nam">name</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t321" class="pln"><span class="n"><a href="#t321">321</a></span><span class="t">            <span class="com"># A bank account can belong to a customer/supplier, in which case their partner_id is the customer/supplier.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t322" class="pln"><span class="n"><a href="#t322">322</a></span><span class="t">            <span class="com"># Or they are part of a bank journal and their partner_id must be the company's partner_id.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t323" class="mis show_mis"><span class="n"><a href="#t323">323</a></span><span class="t">            <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">bank_account_id</span><span class="op">.</span><span class="nam">partner_id</span> <span class="op">!=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">company_id</span><span class="op">.</span><span class="nam">partner_id</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t324" class="mis show_mis"><span class="n"><a href="#t324">324</a></span><span class="t">                <span class="key">raise</span> <span class="nam">ValidationError</span><span class="op">(</span><span class="nam">_</span><span class="op">(</span><span class="str">'The holder of a journal\'s bank account must be the company (%s).'</span><span class="op">)</span> <span class="op">%</span> <span class="nam">self</span><span class="op">.</span><span class="nam">company_id</span><span class="op">.</span><span class="nam">name</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t325" class="pln"><span class="n"><a href="#t325">325</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t326" class="run"><span class="n"><a href="#t326">326</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">onchange</span><span class="op">(</span><span class="str">'default_debit_account_id'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t327" class="pln"><span class="n"><a href="#t327">327</a></span><span class="t">    <span class="key">def</span> <span class="nam">onchange_debit_account_id</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t328" class="mis show_mis"><span class="n"><a href="#t328">328</a></span><span class="t">        <span class="key">if</span> <span class="key">not</span> <span class="nam">self</span><span class="op">.</span><span class="nam">default_credit_account_id</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t329" class="mis show_mis"><span class="n"><a href="#t329">329</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">default_credit_account_id</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">default_debit_account_id</span>&nbsp;</span><span class="r"></span></p>
    <p id="t330" class="pln"><span class="n"><a href="#t330">330</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t331" class="run"><span class="n"><a href="#t331">331</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">onchange</span><span class="op">(</span><span class="str">'default_credit_account_id'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t332" class="pln"><span class="n"><a href="#t332">332</a></span><span class="t">    <span class="key">def</span> <span class="nam">onchange_credit_account_id</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t333" class="mis show_mis"><span class="n"><a href="#t333">333</a></span><span class="t">        <span class="key">if</span> <span class="key">not</span> <span class="nam">self</span><span class="op">.</span><span class="nam">default_debit_account_id</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t334" class="mis show_mis"><span class="n"><a href="#t334">334</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">default_debit_account_id</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">default_credit_account_id</span>&nbsp;</span><span class="r"></span></p>
    <p id="t335" class="pln"><span class="n"><a href="#t335">335</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t336" class="run"><span class="n"><a href="#t336">336</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">multi</span>&nbsp;</span><span class="r"></span></p>
    <p id="t337" class="pln"><span class="n"><a href="#t337">337</a></span><span class="t">    <span class="key">def</span> <span class="nam">unlink</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t338" class="mis show_mis"><span class="n"><a href="#t338">338</a></span><span class="t">        <span class="nam">bank_accounts</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'res.partner.bank'</span><span class="op">]</span><span class="op">.</span><span class="nam">browse</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t339" class="mis show_mis"><span class="n"><a href="#t339">339</a></span><span class="t">        <span class="key">for</span> <span class="nam">bank_account</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">mapped</span><span class="op">(</span><span class="str">'bank_account_id'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t340" class="mis show_mis"><span class="n"><a href="#t340">340</a></span><span class="t">            <span class="nam">accounts</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">search</span><span class="op">(</span><span class="op">[</span><span class="op">(</span><span class="str">'bank_account_id'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="nam">bank_account</span><span class="op">.</span><span class="nam">id</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t341" class="mis show_mis"><span class="n"><a href="#t341">341</a></span><span class="t">            <span class="key">if</span> <span class="nam">accounts</span> <span class="op">&lt;=</span> <span class="nam">self</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t342" class="mis show_mis"><span class="n"><a href="#t342">342</a></span><span class="t">                <span class="nam">bank_accounts</span> <span class="op">+=</span> <span class="nam">bank_account</span>&nbsp;</span><span class="r"></span></p>
    <p id="t343" class="mis show_mis"><span class="n"><a href="#t343">343</a></span><span class="t">        <span class="nam">ret</span> <span class="op">=</span> <span class="nam">super</span><span class="op">(</span><span class="nam">AccountJournal</span><span class="op">,</span> <span class="nam">self</span><span class="op">)</span><span class="op">.</span><span class="nam">unlink</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t344" class="mis show_mis"><span class="n"><a href="#t344">344</a></span><span class="t">        <span class="nam">bank_accounts</span><span class="op">.</span><span class="nam">unlink</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t345" class="mis show_mis"><span class="n"><a href="#t345">345</a></span><span class="t">        <span class="key">return</span> <span class="nam">ret</span>&nbsp;</span><span class="r"></span></p>
    <p id="t346" class="pln"><span class="n"><a href="#t346">346</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t347" class="run"><span class="n"><a href="#t347">347</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">one</span>&nbsp;</span><span class="r"></span></p>
    <p id="t348" class="run"><span class="n"><a href="#t348">348</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">returns</span><span class="op">(</span><span class="str">'self'</span><span class="op">,</span> <span class="key">lambda</span> <span class="nam">value</span><span class="op">:</span> <span class="nam">value</span><span class="op">.</span><span class="nam">id</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t349" class="run"><span class="n"><a href="#t349">349</a></span><span class="t">    <span class="key">def</span> <span class="nam">copy</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t350" class="mis show_mis"><span class="n"><a href="#t350">350</a></span><span class="t">        <span class="nam">default</span> <span class="op">=</span> <span class="nam">dict</span><span class="op">(</span><span class="nam">default</span> <span class="key">or</span> <span class="op">{</span><span class="op">}</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t351" class="mis show_mis"><span class="n"><a href="#t351">351</a></span><span class="t">        <span class="nam">default</span><span class="op">.</span><span class="nam">update</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t352" class="pln"><span class="n"><a href="#t352">352</a></span><span class="t">            <span class="nam">code</span><span class="op">=</span><span class="nam">_</span><span class="op">(</span><span class="str">"%s (copy)"</span><span class="op">)</span> <span class="op">%</span> <span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">code</span> <span class="key">or</span> <span class="str">''</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t353" class="pln"><span class="n"><a href="#t353">353</a></span><span class="t">            <span class="nam">name</span><span class="op">=</span><span class="nam">_</span><span class="op">(</span><span class="str">"%s (copy)"</span><span class="op">)</span> <span class="op">%</span> <span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">name</span> <span class="key">or</span> <span class="str">''</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t354" class="mis show_mis"><span class="n"><a href="#t354">354</a></span><span class="t">        <span class="key">return</span> <span class="nam">super</span><span class="op">(</span><span class="nam">AccountJournal</span><span class="op">,</span> <span class="nam">self</span><span class="op">)</span><span class="op">.</span><span class="nam">copy</span><span class="op">(</span><span class="nam">default</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t355" class="pln"><span class="n"><a href="#t355">355</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t356" class="run"><span class="n"><a href="#t356">356</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">multi</span>&nbsp;</span><span class="r"></span></p>
    <p id="t357" class="pln"><span class="n"><a href="#t357">357</a></span><span class="t">    <span class="key">def</span> <span class="nam">write</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">vals</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t358" class="run"><span class="n"><a href="#t358">358</a></span><span class="t">        <span class="key">for</span> <span class="nam">journal</span> <span class="key">in</span> <span class="nam">self</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t359" class="run"><span class="n"><a href="#t359">359</a></span><span class="t">            <span class="key">if</span> <span class="op">(</span><span class="str">'company_id'</span> <span class="key">in</span> <span class="nam">vals</span> <span class="key">and</span> <span class="nam">journal</span><span class="op">.</span><span class="nam">company_id</span><span class="op">.</span><span class="nam">id</span> <span class="op">!=</span> <span class="nam">vals</span><span class="op">[</span><span class="str">'company_id'</span><span class="op">]</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t360" class="mis show_mis"><span class="n"><a href="#t360">360</a></span><span class="t">                <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'account.move'</span><span class="op">]</span><span class="op">.</span><span class="nam">search</span><span class="op">(</span><span class="op">[</span><span class="op">(</span><span class="str">'journal_id'</span><span class="op">,</span> <span class="str">'in'</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">ids</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">limit</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t361" class="mis show_mis"><span class="n"><a href="#t361">361</a></span><span class="t">                    <span class="key">raise</span> <span class="nam">UserError</span><span class="op">(</span><span class="nam">_</span><span class="op">(</span><span class="str">'This journal already contains items, therefore you cannot modify its company.'</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t362" class="mis show_mis"><span class="n"><a href="#t362">362</a></span><span class="t">                <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">bank_account_id</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t363" class="mis show_mis"><span class="n"><a href="#t363">363</a></span><span class="t">                    <span class="nam">self</span><span class="op">.</span><span class="nam">bank_account_id</span><span class="op">.</span><span class="nam">company_id</span> <span class="op">=</span> <span class="nam">vals</span><span class="op">[</span><span class="str">'company_id'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t364" class="run"><span class="n"><a href="#t364">364</a></span><span class="t">            <span class="key">if</span> <span class="op">(</span><span class="str">'code'</span> <span class="key">in</span> <span class="nam">vals</span> <span class="key">and</span> <span class="nam">journal</span><span class="op">.</span><span class="nam">code</span> <span class="op">!=</span> <span class="nam">vals</span><span class="op">[</span><span class="str">'code'</span><span class="op">]</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t365" class="mis show_mis"><span class="n"><a href="#t365">365</a></span><span class="t">                <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'account.move'</span><span class="op">]</span><span class="op">.</span><span class="nam">search</span><span class="op">(</span><span class="op">[</span><span class="op">(</span><span class="str">'journal_id'</span><span class="op">,</span> <span class="str">'in'</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">ids</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">limit</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t366" class="mis show_mis"><span class="n"><a href="#t366">366</a></span><span class="t">                    <span class="key">raise</span> <span class="nam">UserError</span><span class="op">(</span><span class="nam">_</span><span class="op">(</span><span class="str">'This journal already contains items, therefore you cannot modify its short name.'</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t367" class="mis show_mis"><span class="n"><a href="#t367">367</a></span><span class="t">                <span class="nam">new_prefix</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_get_sequence_prefix</span><span class="op">(</span><span class="nam">vals</span><span class="op">[</span><span class="str">'code'</span><span class="op">]</span><span class="op">,</span> <span class="nam">refund</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t368" class="mis show_mis"><span class="n"><a href="#t368">368</a></span><span class="t">                <span class="nam">journal</span><span class="op">.</span><span class="nam">sequence_id</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="op">{</span><span class="str">'prefix'</span><span class="op">:</span> <span class="nam">new_prefix</span><span class="op">}</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t369" class="mis show_mis"><span class="n"><a href="#t369">369</a></span><span class="t">                <span class="key">if</span> <span class="nam">journal</span><span class="op">.</span><span class="nam">refund_sequence_id</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t370" class="mis show_mis"><span class="n"><a href="#t370">370</a></span><span class="t">                    <span class="nam">new_prefix</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_get_sequence_prefix</span><span class="op">(</span><span class="nam">vals</span><span class="op">[</span><span class="str">'code'</span><span class="op">]</span><span class="op">,</span> <span class="nam">refund</span><span class="op">=</span><span class="nam">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t371" class="mis show_mis"><span class="n"><a href="#t371">371</a></span><span class="t">                    <span class="nam">journal</span><span class="op">.</span><span class="nam">refund_sequence_id</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="op">{</span><span class="str">'prefix'</span><span class="op">:</span> <span class="nam">new_prefix</span><span class="op">}</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t372" class="run"><span class="n"><a href="#t372">372</a></span><span class="t">            <span class="key">if</span> <span class="str">'currency_id'</span> <span class="key">in</span> <span class="nam">vals</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t373" class="mis show_mis"><span class="n"><a href="#t373">373</a></span><span class="t">                <span class="key">if</span> <span class="key">not</span> <span class="str">'default_debit_account_id'</span> <span class="key">in</span> <span class="nam">vals</span> <span class="key">and</span> <span class="nam">self</span><span class="op">.</span><span class="nam">default_debit_account_id</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t374" class="mis show_mis"><span class="n"><a href="#t374">374</a></span><span class="t">                    <span class="nam">self</span><span class="op">.</span><span class="nam">default_debit_account_id</span><span class="op">.</span><span class="nam">currency_id</span> <span class="op">=</span> <span class="nam">vals</span><span class="op">[</span><span class="str">'currency_id'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t375" class="mis show_mis"><span class="n"><a href="#t375">375</a></span><span class="t">                <span class="key">if</span> <span class="key">not</span> <span class="str">'default_credit_account_id'</span> <span class="key">in</span> <span class="nam">vals</span> <span class="key">and</span> <span class="nam">self</span><span class="op">.</span><span class="nam">default_credit_account_id</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t376" class="mis show_mis"><span class="n"><a href="#t376">376</a></span><span class="t">                    <span class="nam">self</span><span class="op">.</span><span class="nam">default_credit_account_id</span><span class="op">.</span><span class="nam">currency_id</span> <span class="op">=</span> <span class="nam">vals</span><span class="op">[</span><span class="str">'currency_id'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t377" class="mis show_mis"><span class="n"><a href="#t377">377</a></span><span class="t">                <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">bank_account_id</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t378" class="mis show_mis"><span class="n"><a href="#t378">378</a></span><span class="t">                    <span class="nam">self</span><span class="op">.</span><span class="nam">bank_account_id</span><span class="op">.</span><span class="nam">currency_id</span> <span class="op">=</span> <span class="nam">vals</span><span class="op">[</span><span class="str">'currency_id'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t379" class="run"><span class="n"><a href="#t379">379</a></span><span class="t">            <span class="key">if</span> <span class="str">'bank_acc_number'</span> <span class="key">in</span> <span class="nam">vals</span> <span class="key">and</span> <span class="key">not</span> <span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'bank_acc_number'</span><span class="op">)</span> <span class="key">and</span> <span class="nam">journal</span><span class="op">.</span><span class="nam">bank_account_id</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t380" class="mis show_mis"><span class="n"><a href="#t380">380</a></span><span class="t">                <span class="key">raise</span> <span class="nam">UserError</span><span class="op">(</span><span class="nam">_</span><span class="op">(</span><span class="str">'You cannot empty the account number once set.\nIf you would like to delete the account number, you can do it from the Bank Accounts list.'</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t381" class="run"><span class="n"><a href="#t381">381</a></span><span class="t">        <span class="nam">result</span> <span class="op">=</span> <span class="nam">super</span><span class="op">(</span><span class="nam">AccountJournal</span><span class="op">,</span> <span class="nam">self</span><span class="op">)</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="nam">vals</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t382" class="pln"><span class="n"><a href="#t382">382</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t383" class="pln"><span class="n"><a href="#t383">383</a></span><span class="t">        <span class="com"># Create the bank_account_id if necessary</span>&nbsp;</span><span class="r"></span></p>
    <p id="t384" class="run"><span class="n"><a href="#t384">384</a></span><span class="t">        <span class="key">if</span> <span class="str">'bank_acc_number'</span> <span class="key">in</span> <span class="nam">vals</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t385" class="mis show_mis"><span class="n"><a href="#t385">385</a></span><span class="t">            <span class="key">for</span> <span class="nam">journal</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">filtered</span><span class="op">(</span><span class="key">lambda</span> <span class="nam">r</span><span class="op">:</span> <span class="nam">r</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'bank'</span> <span class="key">and</span> <span class="key">not</span> <span class="nam">r</span><span class="op">.</span><span class="nam">bank_account_id</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t386" class="mis show_mis"><span class="n"><a href="#t386">386</a></span><span class="t">                <span class="nam">journal</span><span class="op">.</span><span class="nam">set_bank_account</span><span class="op">(</span><span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'bank_acc_number'</span><span class="op">)</span><span class="op">,</span> <span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'bank_id'</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t387" class="pln"><span class="n"><a href="#t387">387</a></span><span class="t">        <span class="com"># create the relevant refund sequence</span>&nbsp;</span><span class="r"></span></p>
    <p id="t388" class="run"><span class="n"><a href="#t388">388</a></span><span class="t">        <span class="key">if</span> <span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'refund_sequence'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t389" class="mis show_mis"><span class="n"><a href="#t389">389</a></span><span class="t">            <span class="key">for</span> <span class="nam">journal</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">filtered</span><span class="op">(</span><span class="key">lambda</span> <span class="nam">j</span><span class="op">:</span> <span class="nam">j</span><span class="op">.</span><span class="nam">type</span> <span class="key">in</span> <span class="op">(</span><span class="str">'sale'</span><span class="op">,</span> <span class="str">'purchase'</span><span class="op">)</span> <span class="key">and</span> <span class="key">not</span> <span class="nam">j</span><span class="op">.</span><span class="nam">refund_sequence_id</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t390" class="mis show_mis"><span class="n"><a href="#t390">390</a></span><span class="t">                <span class="nam">journal_vals</span> <span class="op">=</span> <span class="op">{</span>&nbsp;</span><span class="r"></span></p>
    <p id="t391" class="pln"><span class="n"><a href="#t391">391</a></span><span class="t">                    <span class="str">'name'</span><span class="op">:</span> <span class="nam">journal</span><span class="op">.</span><span class="nam">name</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t392" class="pln"><span class="n"><a href="#t392">392</a></span><span class="t">                    <span class="str">'company_id'</span><span class="op">:</span> <span class="nam">journal</span><span class="op">.</span><span class="nam">company_id</span><span class="op">.</span><span class="nam">id</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t393" class="pln"><span class="n"><a href="#t393">393</a></span><span class="t">                    <span class="str">'code'</span><span class="op">:</span> <span class="nam">journal</span><span class="op">.</span><span class="nam">code</span>&nbsp;</span><span class="r"></span></p>
    <p id="t394" class="pln"><span class="n"><a href="#t394">394</a></span><span class="t">                <span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t395" class="mis show_mis"><span class="n"><a href="#t395">395</a></span><span class="t">                <span class="nam">journal</span><span class="op">.</span><span class="nam">refund_sequence_id</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">sudo</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">_create_sequence</span><span class="op">(</span><span class="nam">journal_vals</span><span class="op">,</span> <span class="nam">refund</span><span class="op">=</span><span class="nam">True</span><span class="op">)</span><span class="op">.</span><span class="nam">id</span>&nbsp;</span><span class="r"></span></p>
    <p id="t396" class="pln"><span class="n"><a href="#t396">396</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t397" class="run"><span class="n"><a href="#t397">397</a></span><span class="t">        <span class="key">return</span> <span class="nam">result</span>&nbsp;</span><span class="r"></span></p>
    <p id="t398" class="pln"><span class="n"><a href="#t398">398</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t399" class="run"><span class="n"><a href="#t399">399</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">model</span>&nbsp;</span><span class="r"></span></p>
    <p id="t400" class="run"><span class="n"><a href="#t400">400</a></span><span class="t">    <span class="key">def</span> <span class="nam">_get_sequence_prefix</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">code</span><span class="op">,</span> <span class="nam">refund</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t401" class="run"><span class="n"><a href="#t401">401</a></span><span class="t">        <span class="nam">prefix</span> <span class="op">=</span> <span class="nam">code</span><span class="op">.</span><span class="nam">upper</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t402" class="run"><span class="n"><a href="#t402">402</a></span><span class="t">        <span class="key">if</span> <span class="nam">refund</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t403" class="mis show_mis"><span class="n"><a href="#t403">403</a></span><span class="t">            <span class="nam">prefix</span> <span class="op">=</span> <span class="str">'R'</span> <span class="op">+</span> <span class="nam">prefix</span>&nbsp;</span><span class="r"></span></p>
    <p id="t404" class="run"><span class="n"><a href="#t404">404</a></span><span class="t">        <span class="key">return</span> <span class="nam">prefix</span> <span class="op">+</span> <span class="str">'/%(range_year)s/'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t405" class="pln"><span class="n"><a href="#t405">405</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t406" class="run"><span class="n"><a href="#t406">406</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">model</span>&nbsp;</span><span class="r"></span></p>
    <p id="t407" class="run"><span class="n"><a href="#t407">407</a></span><span class="t">    <span class="key">def</span> <span class="nam">_create_sequence</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">vals</span><span class="op">,</span> <span class="nam">refund</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t408" class="pln"><span class="n"><a href="#t408">408</a></span><span class="t">        <span class="str">""" Create new no_gap entry sequence for every new Journal"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t409" class="run"><span class="n"><a href="#t409">409</a></span><span class="t">        <span class="nam">prefix</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_get_sequence_prefix</span><span class="op">(</span><span class="nam">vals</span><span class="op">[</span><span class="str">'code'</span><span class="op">]</span><span class="op">,</span> <span class="nam">refund</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t410" class="run"><span class="n"><a href="#t410">410</a></span><span class="t">        <span class="nam">seq</span> <span class="op">=</span> <span class="op">{</span>&nbsp;</span><span class="r"></span></p>
    <p id="t411" class="pln"><span class="n"><a href="#t411">411</a></span><span class="t">            <span class="str">'name'</span><span class="op">:</span> <span class="nam">refund</span> <span class="key">and</span> <span class="nam">vals</span><span class="op">[</span><span class="str">'name'</span><span class="op">]</span> <span class="op">+</span> <span class="nam">_</span><span class="op">(</span><span class="str">': Refund'</span><span class="op">)</span> <span class="key">or</span> <span class="nam">vals</span><span class="op">[</span><span class="str">'name'</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t412" class="pln"><span class="n"><a href="#t412">412</a></span><span class="t">            <span class="str">'implementation'</span><span class="op">:</span> <span class="str">'no_gap'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t413" class="pln"><span class="n"><a href="#t413">413</a></span><span class="t">            <span class="str">'prefix'</span><span class="op">:</span> <span class="nam">prefix</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t414" class="pln"><span class="n"><a href="#t414">414</a></span><span class="t">            <span class="str">'padding'</span><span class="op">:</span> <span class="num">4</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t415" class="pln"><span class="n"><a href="#t415">415</a></span><span class="t">            <span class="str">'number_increment'</span><span class="op">:</span> <span class="num">1</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t416" class="pln"><span class="n"><a href="#t416">416</a></span><span class="t">            <span class="str">'use_date_range'</span><span class="op">:</span> <span class="nam">True</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t417" class="pln"><span class="n"><a href="#t417">417</a></span><span class="t">        <span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t418" class="run"><span class="n"><a href="#t418">418</a></span><span class="t">        <span class="key">if</span> <span class="str">'company_id'</span> <span class="key">in</span> <span class="nam">vals</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t419" class="mis show_mis"><span class="n"><a href="#t419">419</a></span><span class="t">            <span class="nam">seq</span><span class="op">[</span><span class="str">'company_id'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">vals</span><span class="op">[</span><span class="str">'company_id'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t420" class="run"><span class="n"><a href="#t420">420</a></span><span class="t">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'ir.sequence'</span><span class="op">]</span><span class="op">.</span><span class="nam">create</span><span class="op">(</span><span class="nam">seq</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t421" class="pln"><span class="n"><a href="#t421">421</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t422" class="run"><span class="n"><a href="#t422">422</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">model</span>&nbsp;</span><span class="r"></span></p>
    <p id="t423" class="pln"><span class="n"><a href="#t423">423</a></span><span class="t">    <span class="key">def</span> <span class="nam">_prepare_liquidity_account</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">name</span><span class="op">,</span> <span class="nam">company</span><span class="op">,</span> <span class="nam">currency_id</span><span class="op">,</span> <span class="nam">type</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t424" class="pln"><span class="n"><a href="#t424">424</a></span><span class="t">        <span class="str">'''</span>&nbsp;</span><span class="r"></span></p>
    <p id="t425" class="pln"><span class="n"><a href="#t425">425</a></span><span class="t"><span class="str">        This function prepares the value to use for the creation of the default debit and credit accounts of a</span>&nbsp;</span><span class="r"></span></p>
    <p id="t426" class="pln"><span class="n"><a href="#t426">426</a></span><span class="t"><span class="str">        liquidity journal (created through the wizard of generating COA from templates for example).</span>&nbsp;</span><span class="r"></span></p>
    <p id="t427" class="pln"><span class="n"><a href="#t427">427</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t428" class="pln"><span class="n"><a href="#t428">428</a></span><span class="t"><span class="str">        :param name: name of the bank account</span>&nbsp;</span><span class="r"></span></p>
    <p id="t429" class="pln"><span class="n"><a href="#t429">429</a></span><span class="t"><span class="str">        :param company: company for which the wizard is running</span>&nbsp;</span><span class="r"></span></p>
    <p id="t430" class="pln"><span class="n"><a href="#t430">430</a></span><span class="t"><span class="str">        :param currency_id: ID of the currency in wich is the bank account</span>&nbsp;</span><span class="r"></span></p>
    <p id="t431" class="pln"><span class="n"><a href="#t431">431</a></span><span class="t"><span class="str">        :param type: either 'cash' or 'bank'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t432" class="pln"><span class="n"><a href="#t432">432</a></span><span class="t"><span class="str">        :return: mapping of field names and values</span>&nbsp;</span><span class="r"></span></p>
    <p id="t433" class="pln"><span class="n"><a href="#t433">433</a></span><span class="t"><span class="str">        :rtype: dict</span>&nbsp;</span><span class="r"></span></p>
    <p id="t434" class="pln"><span class="n"><a href="#t434">434</a></span><span class="t"><span class="str">        '''</span>&nbsp;</span><span class="r"></span></p>
    <p id="t435" class="pln"><span class="n"><a href="#t435">435</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t436" class="pln"><span class="n"><a href="#t436">436</a></span><span class="t">        <span class="com"># Seek the next available number for the account code</span>&nbsp;</span><span class="r"></span></p>
    <p id="t437" class="mis show_mis"><span class="n"><a href="#t437">437</a></span><span class="t">        <span class="nam">code_digits</span> <span class="op">=</span> <span class="nam">company</span><span class="op">.</span><span class="nam">accounts_code_digits</span> <span class="key">or</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t438" class="mis show_mis"><span class="n"><a href="#t438">438</a></span><span class="t">        <span class="key">if</span> <span class="nam">type</span> <span class="op">==</span> <span class="str">'bank'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t439" class="mis show_mis"><span class="n"><a href="#t439">439</a></span><span class="t">            <span class="nam">account_code_prefix</span> <span class="op">=</span> <span class="nam">company</span><span class="op">.</span><span class="nam">bank_account_code_prefix</span> <span class="key">or</span> <span class="str">''</span>&nbsp;</span><span class="r"></span></p>
    <p id="t440" class="pln"><span class="n"><a href="#t440">440</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t441" class="mis show_mis"><span class="n"><a href="#t441">441</a></span><span class="t">            <span class="nam">account_code_prefix</span> <span class="op">=</span> <span class="nam">company</span><span class="op">.</span><span class="nam">cash_account_code_prefix</span> <span class="key">or</span> <span class="nam">company</span><span class="op">.</span><span class="nam">bank_account_code_prefix</span> <span class="key">or</span> <span class="str">''</span>&nbsp;</span><span class="r"></span></p>
    <p id="t442" class="mis show_mis"><span class="n"><a href="#t442">442</a></span><span class="t">        <span class="key">for</span> <span class="nam">num</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="num">1</span><span class="op">,</span> <span class="num">100</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t443" class="mis show_mis"><span class="n"><a href="#t443">443</a></span><span class="t">            <span class="nam">new_code</span> <span class="op">=</span> <span class="nam">str</span><span class="op">(</span><span class="nam">account_code_prefix</span><span class="op">.</span><span class="nam">ljust</span><span class="op">(</span><span class="nam">code_digits</span> <span class="op">-</span> <span class="num">1</span><span class="op">,</span> <span class="str">'0'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="nam">str</span><span class="op">(</span><span class="nam">num</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t444" class="mis show_mis"><span class="n"><a href="#t444">444</a></span><span class="t">            <span class="nam">rec</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'account.account'</span><span class="op">]</span><span class="op">.</span><span class="nam">search</span><span class="op">(</span><span class="op">[</span><span class="op">(</span><span class="str">'code'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="nam">new_code</span><span class="op">)</span><span class="op">,</span> <span class="op">(</span><span class="str">'company_id'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="nam">company</span><span class="op">.</span><span class="nam">id</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">limit</span><span class="op">=</span><span class="num">1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t445" class="mis show_mis"><span class="n"><a href="#t445">445</a></span><span class="t">            <span class="key">if</span> <span class="key">not</span> <span class="nam">rec</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t446" class="mis show_mis"><span class="n"><a href="#t446">446</a></span><span class="t">                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t447" class="pln"><span class="n"><a href="#t447">447</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t448" class="mis show_mis"><span class="n"><a href="#t448">448</a></span><span class="t">            <span class="key">raise</span> <span class="nam">UserError</span><span class="op">(</span><span class="nam">_</span><span class="op">(</span><span class="str">'Cannot generate an unused account code.'</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t449" class="pln"><span class="n"><a href="#t449">449</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t450" class="mis show_mis"><span class="n"><a href="#t450">450</a></span><span class="t">        <span class="nam">liquidity_type</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">ref</span><span class="op">(</span><span class="str">'account.data_account_type_liquidity'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t451" class="mis show_mis"><span class="n"><a href="#t451">451</a></span><span class="t">        <span class="key">return</span> <span class="op">{</span>&nbsp;</span><span class="r"></span></p>
    <p id="t452" class="pln"><span class="n"><a href="#t452">452</a></span><span class="t">                <span class="str">'name'</span><span class="op">:</span> <span class="nam">name</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t453" class="pln"><span class="n"><a href="#t453">453</a></span><span class="t">                <span class="str">'currency_id'</span><span class="op">:</span> <span class="nam">currency_id</span> <span class="key">or</span> <span class="nam">False</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t454" class="pln"><span class="n"><a href="#t454">454</a></span><span class="t">                <span class="str">'code'</span><span class="op">:</span> <span class="nam">new_code</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t455" class="pln"><span class="n"><a href="#t455">455</a></span><span class="t">                <span class="str">'user_type_id'</span><span class="op">:</span> <span class="nam">liquidity_type</span> <span class="key">and</span> <span class="nam">liquidity_type</span><span class="op">.</span><span class="nam">id</span> <span class="key">or</span> <span class="nam">False</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t456" class="pln"><span class="n"><a href="#t456">456</a></span><span class="t">                <span class="str">'company_id'</span><span class="op">:</span> <span class="nam">company</span><span class="op">.</span><span class="nam">id</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t457" class="pln"><span class="n"><a href="#t457">457</a></span><span class="t">        <span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t458" class="pln"><span class="n"><a href="#t458">458</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t459" class="run"><span class="n"><a href="#t459">459</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">model</span>&nbsp;</span><span class="r"></span></p>
    <p id="t460" class="pln"><span class="n"><a href="#t460">460</a></span><span class="t">    <span class="key">def</span> <span class="nam">create</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">vals</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t461" class="run"><span class="n"><a href="#t461">461</a></span><span class="t">        <span class="nam">company_id</span> <span class="op">=</span> <span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'company_id'</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">user</span><span class="op">.</span><span class="nam">company_id</span><span class="op">.</span><span class="nam">id</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t462" class="run"><span class="n"><a href="#t462">462</a></span><span class="t">        <span class="key">if</span> <span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'type'</span><span class="op">)</span> <span class="key">in</span> <span class="op">(</span><span class="str">'bank'</span><span class="op">,</span> <span class="str">'cash'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t463" class="pln"><span class="n"><a href="#t463">463</a></span><span class="t">            <span class="com"># For convenience, the name can be inferred from account number</span>&nbsp;</span><span class="r"></span></p>
    <p id="t464" class="mis show_mis"><span class="n"><a href="#t464">464</a></span><span class="t">            <span class="key">if</span> <span class="key">not</span> <span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'name'</span><span class="op">)</span> <span class="key">and</span> <span class="str">'bank_acc_number'</span> <span class="key">in</span> <span class="nam">vals</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t465" class="mis show_mis"><span class="n"><a href="#t465">465</a></span><span class="t">                <span class="nam">vals</span><span class="op">[</span><span class="str">'name'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">vals</span><span class="op">[</span><span class="str">'bank_acc_number'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t466" class="pln"><span class="n"><a href="#t466">466</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t467" class="pln"><span class="n"><a href="#t467">467</a></span><span class="t">            <span class="com"># If no code provided, loop to find next available journal code</span>&nbsp;</span><span class="r"></span></p>
    <p id="t468" class="mis show_mis"><span class="n"><a href="#t468">468</a></span><span class="t">            <span class="key">if</span> <span class="key">not</span> <span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'code'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t469" class="mis show_mis"><span class="n"><a href="#t469">469</a></span><span class="t">                <span class="nam">journal_code_base</span> <span class="op">=</span> <span class="op">(</span><span class="nam">vals</span><span class="op">[</span><span class="str">'type'</span><span class="op">]</span> <span class="op">==</span> <span class="str">'cash'</span> <span class="key">and</span> <span class="str">'CSH'</span> <span class="key">or</span> <span class="str">'BNK'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t470" class="mis show_mis"><span class="n"><a href="#t470">470</a></span><span class="t">                <span class="nam">journals</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'account.journal'</span><span class="op">]</span><span class="op">.</span><span class="nam">search</span><span class="op">(</span><span class="op">[</span><span class="op">(</span><span class="str">'code'</span><span class="op">,</span> <span class="str">'like'</span><span class="op">,</span> <span class="nam">journal_code_base</span> <span class="op">+</span> <span class="str">'%'</span><span class="op">)</span><span class="op">,</span> <span class="op">(</span><span class="str">'company_id'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="nam">company_id</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t471" class="mis show_mis"><span class="n"><a href="#t471">471</a></span><span class="t">                <span class="key">for</span> <span class="nam">num</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="num">1</span><span class="op">,</span> <span class="num">100</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t472" class="pln"><span class="n"><a href="#t472">472</a></span><span class="t">                    <span class="com"># journal_code has a maximal size of 5, hence we can enforce the boundary num &lt; 100</span>&nbsp;</span><span class="r"></span></p>
    <p id="t473" class="mis show_mis"><span class="n"><a href="#t473">473</a></span><span class="t">                    <span class="nam">journal_code</span> <span class="op">=</span> <span class="nam">journal_code_base</span> <span class="op">+</span> <span class="nam">str</span><span class="op">(</span><span class="nam">num</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t474" class="mis show_mis"><span class="n"><a href="#t474">474</a></span><span class="t">                    <span class="key">if</span> <span class="nam">journal_code</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">journals</span><span class="op">.</span><span class="nam">mapped</span><span class="op">(</span><span class="str">'code'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t475" class="mis show_mis"><span class="n"><a href="#t475">475</a></span><span class="t">                        <span class="nam">vals</span><span class="op">[</span><span class="str">'code'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">journal_code</span>&nbsp;</span><span class="r"></span></p>
    <p id="t476" class="mis show_mis"><span class="n"><a href="#t476">476</a></span><span class="t">                        <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t477" class="pln"><span class="n"><a href="#t477">477</a></span><span class="t">                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t478" class="mis show_mis"><span class="n"><a href="#t478">478</a></span><span class="t">                    <span class="key">raise</span> <span class="nam">UserError</span><span class="op">(</span><span class="nam">_</span><span class="op">(</span><span class="str">"Cannot generate an unused journal code. Please fill the 'Shortcode' field."</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t479" class="pln"><span class="n"><a href="#t479">479</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t480" class="pln"><span class="n"><a href="#t480">480</a></span><span class="t">            <span class="com"># Create a default debit/credit account if not given</span>&nbsp;</span><span class="r"></span></p>
    <p id="t481" class="mis show_mis"><span class="n"><a href="#t481">481</a></span><span class="t">            <span class="nam">default_account</span> <span class="op">=</span> <span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'default_debit_account_id'</span><span class="op">)</span> <span class="key">or</span> <span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'default_credit_account_id'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t482" class="mis show_mis"><span class="n"><a href="#t482">482</a></span><span class="t">            <span class="key">if</span> <span class="key">not</span> <span class="nam">default_account</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t483" class="mis show_mis"><span class="n"><a href="#t483">483</a></span><span class="t">                <span class="nam">company</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'res.company'</span><span class="op">]</span><span class="op">.</span><span class="nam">browse</span><span class="op">(</span><span class="nam">company_id</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t484" class="mis show_mis"><span class="n"><a href="#t484">484</a></span><span class="t">                <span class="nam">account_vals</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_prepare_liquidity_account</span><span class="op">(</span><span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'name'</span><span class="op">)</span><span class="op">,</span> <span class="nam">company</span><span class="op">,</span> <span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'currency_id'</span><span class="op">)</span><span class="op">,</span> <span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'type'</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t485" class="mis show_mis"><span class="n"><a href="#t485">485</a></span><span class="t">                <span class="nam">default_account</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'account.account'</span><span class="op">]</span><span class="op">.</span><span class="nam">create</span><span class="op">(</span><span class="nam">account_vals</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t486" class="mis show_mis"><span class="n"><a href="#t486">486</a></span><span class="t">                <span class="nam">vals</span><span class="op">[</span><span class="str">'default_debit_account_id'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">default_account</span><span class="op">.</span><span class="nam">id</span>&nbsp;</span><span class="r"></span></p>
    <p id="t487" class="mis show_mis"><span class="n"><a href="#t487">487</a></span><span class="t">                <span class="nam">vals</span><span class="op">[</span><span class="str">'default_credit_account_id'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">default_account</span><span class="op">.</span><span class="nam">id</span>&nbsp;</span><span class="r"></span></p>
    <p id="t488" class="pln"><span class="n"><a href="#t488">488</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t489" class="pln"><span class="n"><a href="#t489">489</a></span><span class="t">        <span class="com"># We just need to create the relevant sequences according to the chosen options</span>&nbsp;</span><span class="r"></span></p>
    <p id="t490" class="run"><span class="n"><a href="#t490">490</a></span><span class="t">        <span class="key">if</span> <span class="key">not</span> <span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'sequence_id'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t491" class="run"><span class="n"><a href="#t491">491</a></span><span class="t">            <span class="nam">vals</span><span class="op">.</span><span class="nam">update</span><span class="op">(</span><span class="op">{</span><span class="str">'sequence_id'</span><span class="op">:</span> <span class="nam">self</span><span class="op">.</span><span class="nam">sudo</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">_create_sequence</span><span class="op">(</span><span class="nam">vals</span><span class="op">)</span><span class="op">.</span><span class="nam">id</span><span class="op">}</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t492" class="run"><span class="n"><a href="#t492">492</a></span><span class="t">        <span class="key">if</span> <span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'type'</span><span class="op">)</span> <span class="key">in</span> <span class="op">(</span><span class="str">'sale'</span><span class="op">,</span> <span class="str">'purchase'</span><span class="op">)</span> <span class="key">and</span> <span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'refund_sequence'</span><span class="op">)</span> <span class="key">and</span> <span class="key">not</span> <span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'refund_sequence_id'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t493" class="mis show_mis"><span class="n"><a href="#t493">493</a></span><span class="t">            <span class="nam">vals</span><span class="op">.</span><span class="nam">update</span><span class="op">(</span><span class="op">{</span><span class="str">'refund_sequence_id'</span><span class="op">:</span> <span class="nam">self</span><span class="op">.</span><span class="nam">sudo</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">_create_sequence</span><span class="op">(</span><span class="nam">vals</span><span class="op">,</span> <span class="nam">refund</span><span class="op">=</span><span class="nam">True</span><span class="op">)</span><span class="op">.</span><span class="nam">id</span><span class="op">}</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t494" class="pln"><span class="n"><a href="#t494">494</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t495" class="run"><span class="n"><a href="#t495">495</a></span><span class="t">        <span class="nam">journal</span> <span class="op">=</span> <span class="nam">super</span><span class="op">(</span><span class="nam">AccountJournal</span><span class="op">,</span> <span class="nam">self</span><span class="op">)</span><span class="op">.</span><span class="nam">create</span><span class="op">(</span><span class="nam">vals</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t496" class="pln"><span class="n"><a href="#t496">496</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t497" class="pln"><span class="n"><a href="#t497">497</a></span><span class="t">        <span class="com"># Create the bank_account_id if necessary</span>&nbsp;</span><span class="r"></span></p>
    <p id="t498" class="run"><span class="n"><a href="#t498">498</a></span><span class="t">        <span class="key">if</span> <span class="nam">journal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'bank'</span> <span class="key">and</span> <span class="key">not</span> <span class="nam">journal</span><span class="op">.</span><span class="nam">bank_account_id</span> <span class="key">and</span> <span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'bank_acc_number'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t499" class="mis show_mis"><span class="n"><a href="#t499">499</a></span><span class="t">            <span class="nam">journal</span><span class="op">.</span><span class="nam">set_bank_account</span><span class="op">(</span><span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'bank_acc_number'</span><span class="op">)</span><span class="op">,</span> <span class="nam">vals</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'bank_id'</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t500" class="pln"><span class="n"><a href="#t500">500</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t501" class="run"><span class="n"><a href="#t501">501</a></span><span class="t">        <span class="key">return</span> <span class="nam">journal</span>&nbsp;</span><span class="r"></span></p>
    <p id="t502" class="pln"><span class="n"><a href="#t502">502</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t503" class="run"><span class="n"><a href="#t503">503</a></span><span class="t">    <span class="key">def</span> <span class="nam">set_bank_account</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">acc_number</span><span class="op">,</span> <span class="nam">bank_id</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t504" class="pln"><span class="n"><a href="#t504">504</a></span><span class="t">        <span class="str">""" Create a res.partner.bank and set it as value of the  field bank_account_id """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t505" class="mis show_mis"><span class="n"><a href="#t505">505</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">ensure_one</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t506" class="mis show_mis"><span class="n"><a href="#t506">506</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">bank_account_id</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'res.partner.bank'</span><span class="op">]</span><span class="op">.</span><span class="nam">create</span><span class="op">(</span><span class="op">{</span>&nbsp;</span><span class="r"></span></p>
    <p id="t507" class="pln"><span class="n"><a href="#t507">507</a></span><span class="t">            <span class="str">'acc_number'</span><span class="op">:</span> <span class="nam">acc_number</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t508" class="pln"><span class="n"><a href="#t508">508</a></span><span class="t">            <span class="str">'bank_id'</span><span class="op">:</span> <span class="nam">bank_id</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t509" class="pln"><span class="n"><a href="#t509">509</a></span><span class="t">            <span class="str">'company_id'</span><span class="op">:</span> <span class="nam">self</span><span class="op">.</span><span class="nam">company_id</span><span class="op">.</span><span class="nam">id</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t510" class="pln"><span class="n"><a href="#t510">510</a></span><span class="t">            <span class="str">'currency_id'</span><span class="op">:</span> <span class="nam">self</span><span class="op">.</span><span class="nam">currency_id</span><span class="op">.</span><span class="nam">id</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t511" class="pln"><span class="n"><a href="#t511">511</a></span><span class="t">            <span class="str">'partner_id'</span><span class="op">:</span> <span class="nam">self</span><span class="op">.</span><span class="nam">company_id</span><span class="op">.</span><span class="nam">partner_id</span><span class="op">.</span><span class="nam">id</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t512" class="pln"><span class="n"><a href="#t512">512</a></span><span class="t">        <span class="op">}</span><span class="op">)</span><span class="op">.</span><span class="nam">id</span>&nbsp;</span><span class="r"></span></p>
    <p id="t513" class="pln"><span class="n"><a href="#t513">513</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t514" class="run"><span class="n"><a href="#t514">514</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">multi</span>&nbsp;</span><span class="r"></span></p>
    <p id="t515" class="run"><span class="n"><a href="#t515">515</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">depends</span><span class="op">(</span><span class="str">'name'</span><span class="op">,</span> <span class="str">'currency_id'</span><span class="op">,</span> <span class="str">'company_id'</span><span class="op">,</span> <span class="str">'company_id.currency_id'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t516" class="pln"><span class="n"><a href="#t516">516</a></span><span class="t">    <span class="key">def</span> <span class="nam">name_get</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t517" class="mis show_mis"><span class="n"><a href="#t517">517</a></span><span class="t">        <span class="nam">res</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t518" class="mis show_mis"><span class="n"><a href="#t518">518</a></span><span class="t">        <span class="key">for</span> <span class="nam">journal</span> <span class="key">in</span> <span class="nam">self</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t519" class="mis show_mis"><span class="n"><a href="#t519">519</a></span><span class="t">            <span class="nam">currency</span> <span class="op">=</span> <span class="nam">journal</span><span class="op">.</span><span class="nam">currency_id</span> <span class="key">or</span> <span class="nam">journal</span><span class="op">.</span><span class="nam">company_id</span><span class="op">.</span><span class="nam">currency_id</span>&nbsp;</span><span class="r"></span></p>
    <p id="t520" class="mis show_mis"><span class="n"><a href="#t520">520</a></span><span class="t">            <span class="nam">name</span> <span class="op">=</span> <span class="str">"%s (%s)"</span> <span class="op">%</span> <span class="op">(</span><span class="nam">journal</span><span class="op">.</span><span class="nam">name</span><span class="op">,</span> <span class="nam">currency</span><span class="op">.</span><span class="nam">name</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t521" class="mis show_mis"><span class="n"><a href="#t521">521</a></span><span class="t">            <span class="nam">res</span> <span class="op">+=</span> <span class="op">[</span><span class="op">(</span><span class="nam">journal</span><span class="op">.</span><span class="nam">id</span><span class="op">,</span> <span class="nam">name</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t522" class="mis show_mis"><span class="n"><a href="#t522">522</a></span><span class="t">        <span class="key">return</span> <span class="nam">res</span>&nbsp;</span><span class="r"></span></p>
    <p id="t523" class="pln"><span class="n"><a href="#t523">523</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t524" class="run"><span class="n"><a href="#t524">524</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">model</span>&nbsp;</span><span class="r"></span></p>
    <p id="t525" class="run"><span class="n"><a href="#t525">525</a></span><span class="t">    <span class="key">def</span> <span class="nam">name_search</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">name</span><span class="op">=</span><span class="str">''</span><span class="op">,</span> <span class="nam">args</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">operator</span><span class="op">=</span><span class="str">'ilike'</span><span class="op">,</span> <span class="nam">limit</span><span class="op">=</span><span class="num">100</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t526" class="mis show_mis"><span class="n"><a href="#t526">526</a></span><span class="t">        <span class="nam">args</span> <span class="op">=</span> <span class="nam">args</span> <span class="key">or</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t527" class="mis show_mis"><span class="n"><a href="#t527">527</a></span><span class="t">        <span class="nam">connector</span> <span class="op">=</span> <span class="str">'|'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t528" class="mis show_mis"><span class="n"><a href="#t528">528</a></span><span class="t">        <span class="key">if</span> <span class="nam">operator</span> <span class="key">in</span> <span class="nam">expression</span><span class="op">.</span><span class="nam">NEGATIVE_TERM_OPERATORS</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t529" class="mis show_mis"><span class="n"><a href="#t529">529</a></span><span class="t">            <span class="nam">connector</span> <span class="op">=</span> <span class="str">'&amp;'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t530" class="mis show_mis"><span class="n"><a href="#t530">530</a></span><span class="t">        <span class="nam">recs</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">search</span><span class="op">(</span><span class="op">[</span><span class="nam">connector</span><span class="op">,</span> <span class="op">(</span><span class="str">'code'</span><span class="op">,</span> <span class="nam">operator</span><span class="op">,</span> <span class="nam">name</span><span class="op">)</span><span class="op">,</span> <span class="op">(</span><span class="str">'name'</span><span class="op">,</span> <span class="nam">operator</span><span class="op">,</span> <span class="nam">name</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="nam">args</span><span class="op">,</span> <span class="nam">limit</span><span class="op">=</span><span class="nam">limit</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t531" class="mis show_mis"><span class="n"><a href="#t531">531</a></span><span class="t">        <span class="key">return</span> <span class="nam">recs</span><span class="op">.</span><span class="nam">name_get</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t532" class="pln"><span class="n"><a href="#t532">532</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t533" class="run"><span class="n"><a href="#t533">533</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">multi</span>&nbsp;</span><span class="r"></span></p>
    <p id="t534" class="run"><span class="n"><a href="#t534">534</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">depends</span><span class="op">(</span><span class="str">'company_id'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t535" class="pln"><span class="n"><a href="#t535">535</a></span><span class="t">    <span class="key">def</span> <span class="nam">_belong_to_company</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t536" class="mis show_mis"><span class="n"><a href="#t536">536</a></span><span class="t">        <span class="key">for</span> <span class="nam">journal</span> <span class="key">in</span> <span class="nam">self</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t537" class="mis show_mis"><span class="n"><a href="#t537">537</a></span><span class="t">            <span class="nam">journal</span><span class="op">.</span><span class="nam">belong_to_company</span> <span class="op">=</span> <span class="op">(</span><span class="nam">journal</span><span class="op">.</span><span class="nam">company_id</span><span class="op">.</span><span class="nam">id</span> <span class="op">==</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">user</span><span class="op">.</span><span class="nam">company_id</span><span class="op">.</span><span class="nam">id</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t538" class="pln"><span class="n"><a href="#t538">538</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t539" class="run"><span class="n"><a href="#t539">539</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">multi</span>&nbsp;</span><span class="r"></span></p>
    <p id="t540" class="pln"><span class="n"><a href="#t540">540</a></span><span class="t">    <span class="key">def</span> <span class="nam">_search_company_journals</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">operator</span><span class="op">,</span> <span class="nam">value</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t541" class="mis show_mis"><span class="n"><a href="#t541">541</a></span><span class="t">        <span class="key">if</span> <span class="nam">value</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t542" class="mis show_mis"><span class="n"><a href="#t542">542</a></span><span class="t">            <span class="nam">recs</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">search</span><span class="op">(</span><span class="op">[</span><span class="op">(</span><span class="str">'company_id'</span><span class="op">,</span> <span class="nam">operator</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">user</span><span class="op">.</span><span class="nam">company_id</span><span class="op">.</span><span class="nam">id</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t543" class="mis show_mis"><span class="n"><a href="#t543">543</a></span><span class="t">        <span class="key">elif</span> <span class="nam">operator</span> <span class="op">==</span> <span class="str">'='</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t544" class="mis show_mis"><span class="n"><a href="#t544">544</a></span><span class="t">            <span class="nam">recs</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">search</span><span class="op">(</span><span class="op">[</span><span class="op">(</span><span class="str">'company_id'</span><span class="op">,</span> <span class="str">'!='</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">user</span><span class="op">.</span><span class="nam">company_id</span><span class="op">.</span><span class="nam">id</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t545" class="pln"><span class="n"><a href="#t545">545</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t546" class="mis show_mis"><span class="n"><a href="#t546">546</a></span><span class="t">            <span class="nam">recs</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">search</span><span class="op">(</span><span class="op">[</span><span class="op">(</span><span class="str">'company_id'</span><span class="op">,</span> <span class="nam">operator</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">user</span><span class="op">.</span><span class="nam">company_id</span><span class="op">.</span><span class="nam">id</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t547" class="mis show_mis"><span class="n"><a href="#t547">547</a></span><span class="t">        <span class="key">return</span> <span class="op">[</span><span class="op">(</span><span class="str">'id'</span><span class="op">,</span> <span class="str">'in'</span><span class="op">,</span> <span class="op">[</span><span class="nam">x</span><span class="op">.</span><span class="nam">id</span> <span class="key">for</span> <span class="nam">x</span> <span class="key">in</span> <span class="nam">recs</span><span class="op">]</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t548" class="pln"><span class="n"><a href="#t548">548</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t549" class="run"><span class="n"><a href="#t549">549</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">multi</span>&nbsp;</span><span class="r"></span></p>
    <p id="t550" class="run"><span class="n"><a href="#t550">550</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">depends</span><span class="op">(</span><span class="str">'inbound_payment_method_ids'</span><span class="op">,</span> <span class="str">'outbound_payment_method_ids'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t551" class="pln"><span class="n"><a href="#t551">551</a></span><span class="t">    <span class="key">def</span> <span class="nam">_methods_compute</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t552" class="run"><span class="n"><a href="#t552">552</a></span><span class="t">        <span class="key">for</span> <span class="nam">journal</span> <span class="key">in</span> <span class="nam">self</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t553" class="run"><span class="n"><a href="#t553">553</a></span><span class="t">            <span class="nam">journal</span><span class="op">.</span><span class="nam">at_least_one_inbound</span> <span class="op">=</span> <span class="nam">bool</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">journal</span><span class="op">.</span><span class="nam">inbound_payment_method_ids</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t554" class="run"><span class="n"><a href="#t554">554</a></span><span class="t">            <span class="nam">journal</span><span class="op">.</span><span class="nam">at_least_one_outbound</span> <span class="op">=</span> <span class="nam">bool</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">journal</span><span class="op">.</span><span class="nam">outbound_payment_method_ids</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t555" class="pln"><span class="n"><a href="#t555">555</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t556" class="pln"><span class="n"><a href="#t556">556</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t557" class="run"><span class="n"><a href="#t557">557</a></span><span class="t"><span class="key">class</span> <span class="nam">ResPartnerBank</span><span class="op">(</span><span class="nam">models</span><span class="op">.</span><span class="nam">Model</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t558" class="run"><span class="n"><a href="#t558">558</a></span><span class="t">    <span class="nam">_inherit</span> <span class="op">=</span> <span class="str">"res.partner.bank"</span>&nbsp;</span><span class="r"></span></p>
    <p id="t559" class="pln"><span class="n"><a href="#t559">559</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t560" class="run"><span class="n"><a href="#t560">560</a></span><span class="t">    <span class="nam">journal_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">One2many</span><span class="op">(</span><span class="str">'account.journal'</span><span class="op">,</span> <span class="str">'bank_account_id'</span><span class="op">,</span> <span class="nam">domain</span><span class="op">=</span><span class="op">[</span><span class="op">(</span><span class="str">'type'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="str">'bank'</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Account Journal'</span><span class="op">,</span> <span class="nam">readonly</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t561" class="pln"><span class="n"><a href="#t561">561</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"The accounting journal corresponding to this bank account."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t562" class="pln"><span class="n"><a href="#t562">562</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t563" class="run"><span class="n"><a href="#t563">563</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">one</span>&nbsp;</span><span class="r"></span></p>
    <p id="t564" class="run"><span class="n"><a href="#t564">564</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">constrains</span><span class="op">(</span><span class="str">'journal_id'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t565" class="pln"><span class="n"><a href="#t565">565</a></span><span class="t">    <span class="key">def</span> <span class="nam">_check_journal_id</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t566" class="mis show_mis"><span class="n"><a href="#t566">566</a></span><span class="t">        <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">journal_id</span><span class="op">)</span> <span class="op">></span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t567" class="mis show_mis"><span class="n"><a href="#t567">567</a></span><span class="t">            <span class="key">raise</span> <span class="nam">ValidationError</span><span class="op">(</span><span class="nam">_</span><span class="op">(</span><span class="str">'A bank account can only belong to one journal.'</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t568" class="pln"><span class="n"><a href="#t568">568</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t569" class="pln"><span class="n"><a href="#t569">569</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t570" class="pln"><span class="n"><a href="#t570">570</a></span><span class="t"><span class="com">#----------------------------------------------------------</span>&nbsp;</span><span class="r"></span></p>
    <p id="t571" class="pln"><span class="n"><a href="#t571">571</a></span><span class="t"><span class="com"># Tax</span>&nbsp;</span><span class="r"></span></p>
    <p id="t572" class="pln"><span class="n"><a href="#t572">572</a></span><span class="t"><span class="com">#----------------------------------------------------------</span>&nbsp;</span><span class="r"></span></p>
    <p id="t573" class="pln"><span class="n"><a href="#t573">573</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t574" class="run"><span class="n"><a href="#t574">574</a></span><span class="t"><span class="key">class</span> <span class="nam">AccountTaxGroup</span><span class="op">(</span><span class="nam">models</span><span class="op">.</span><span class="nam">Model</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t575" class="run"><span class="n"><a href="#t575">575</a></span><span class="t">    <span class="nam">_name</span> <span class="op">=</span> <span class="str">'account.tax.group'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t576" class="run"><span class="n"><a href="#t576">576</a></span><span class="t">    <span class="nam">_order</span> <span class="op">=</span> <span class="str">'sequence asc'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t577" class="pln"><span class="n"><a href="#t577">577</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t578" class="run"><span class="n"><a href="#t578">578</a></span><span class="t">    <span class="nam">name</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Char</span><span class="op">(</span><span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">translate</span><span class="op">=</span><span class="nam">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t579" class="run"><span class="n"><a href="#t579">579</a></span><span class="t">    <span class="nam">sequence</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Integer</span><span class="op">(</span><span class="nam">default</span><span class="op">=</span><span class="num">10</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t580" class="pln"><span class="n"><a href="#t580">580</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t581" class="run"><span class="n"><a href="#t581">581</a></span><span class="t"><span class="key">class</span> <span class="nam">AccountTax</span><span class="op">(</span><span class="nam">models</span><span class="op">.</span><span class="nam">Model</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t582" class="run"><span class="n"><a href="#t582">582</a></span><span class="t">    <span class="nam">_name</span> <span class="op">=</span> <span class="str">'account.tax'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t583" class="run"><span class="n"><a href="#t583">583</a></span><span class="t">    <span class="nam">_description</span> <span class="op">=</span> <span class="str">'Tax'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t584" class="run"><span class="n"><a href="#t584">584</a></span><span class="t">    <span class="nam">_order</span> <span class="op">=</span> <span class="str">'sequence,id'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t585" class="pln"><span class="n"><a href="#t585">585</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t586" class="run"><span class="n"><a href="#t586">586</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">model</span>&nbsp;</span><span class="r"></span></p>
    <p id="t587" class="pln"><span class="n"><a href="#t587">587</a></span><span class="t">    <span class="key">def</span> <span class="nam">_default_tax_group</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t588" class="mis show_mis"><span class="n"><a href="#t588">588</a></span><span class="t">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'account.tax.group'</span><span class="op">]</span><span class="op">.</span><span class="nam">search</span><span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="nam">limit</span><span class="op">=</span><span class="num">1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t589" class="pln"><span class="n"><a href="#t589">589</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t590" class="run"><span class="n"><a href="#t590">590</a></span><span class="t">    <span class="nam">name</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Char</span><span class="op">(</span><span class="nam">string</span><span class="op">=</span><span class="str">'Tax Name'</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">translate</span><span class="op">=</span><span class="nam">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t591" class="run"><span class="n"><a href="#t591">591</a></span><span class="t">    <span class="nam">type_tax_use</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Selection</span><span class="op">(</span><span class="op">[</span><span class="op">(</span><span class="str">'sale'</span><span class="op">,</span> <span class="str">'Sales'</span><span class="op">)</span><span class="op">,</span> <span class="op">(</span><span class="str">'purchase'</span><span class="op">,</span> <span class="str">'Purchases'</span><span class="op">)</span><span class="op">,</span> <span class="op">(</span><span class="str">'none'</span><span class="op">,</span> <span class="str">'None'</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Tax Scope'</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">"sale"</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t592" class="pln"><span class="n"><a href="#t592">592</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"Determines where the tax is selectable. Note : 'None' means a tax can't be used by itself, however it can still be used in a group."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t593" class="run"><span class="n"><a href="#t593">593</a></span><span class="t">    <span class="nam">tax_adjustment</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Boolean</span><span class="op">(</span><span class="nam">help</span><span class="op">=</span><span class="str">'Set this field to true if this tax can be used in the tax adjustment wizard, used to manually fill some data in the tax declaration'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t594" class="run"><span class="n"><a href="#t594">594</a></span><span class="t">    <span class="nam">amount_type</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Selection</span><span class="op">(</span><span class="nam">default</span><span class="op">=</span><span class="str">'percent'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">"Tax Computation"</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">oldname</span><span class="op">=</span><span class="str">'type'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t595" class="pln"><span class="n"><a href="#t595">595</a></span><span class="t">        <span class="nam">selection</span><span class="op">=</span><span class="op">[</span><span class="op">(</span><span class="str">'group'</span><span class="op">,</span> <span class="str">'Group of Taxes'</span><span class="op">)</span><span class="op">,</span> <span class="op">(</span><span class="str">'fixed'</span><span class="op">,</span> <span class="str">'Fixed'</span><span class="op">)</span><span class="op">,</span> <span class="op">(</span><span class="str">'percent'</span><span class="op">,</span> <span class="str">'Percentage of Price'</span><span class="op">)</span><span class="op">,</span> <span class="op">(</span><span class="str">'division'</span><span class="op">,</span> <span class="str">'Percentage of Price Tax Included'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t596" class="run"><span class="n"><a href="#t596">596</a></span><span class="t">    <span class="nam">active</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Boolean</span><span class="op">(</span><span class="nam">default</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Set active to false to hide the tax without removing it."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t597" class="run"><span class="n"><a href="#t597">597</a></span><span class="t">    <span class="nam">company_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'res.company'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Company'</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="key">lambda</span> <span class="nam">self</span><span class="op">:</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">user</span><span class="op">.</span><span class="nam">company_id</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t598" class="run"><span class="n"><a href="#t598">598</a></span><span class="t">    <span class="nam">children_tax_ids</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2many</span><span class="op">(</span><span class="str">'account.tax'</span><span class="op">,</span> <span class="str">'account_tax_filiation_rel'</span><span class="op">,</span> <span class="str">'parent_tax'</span><span class="op">,</span> <span class="str">'child_tax'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Children Taxes'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t599" class="run"><span class="n"><a href="#t599">599</a></span><span class="t">    <span class="nam">sequence</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Integer</span><span class="op">(</span><span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">1</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t600" class="pln"><span class="n"><a href="#t600">600</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"The sequence field is used to define order in which the tax lines are applied."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t601" class="run"><span class="n"><a href="#t601">601</a></span><span class="t">    <span class="nam">amount</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Float</span><span class="op">(</span><span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">digits</span><span class="op">=</span><span class="op">(</span><span class="num">16</span><span class="op">,</span> <span class="num">4</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t602" class="run"><span class="n"><a href="#t602">602</a></span><span class="t">    <span class="nam">account_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'account.account'</span><span class="op">,</span> <span class="nam">domain</span><span class="op">=</span><span class="op">[</span><span class="op">(</span><span class="str">'deprecated'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="nam">False</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Tax Account'</span><span class="op">,</span> <span class="nam">ondelete</span><span class="op">=</span><span class="str">'restrict'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t603" class="pln"><span class="n"><a href="#t603">603</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"Account that will be set on invoice tax lines for invoices. Leave empty to use the expense account."</span><span class="op">,</span> <span class="nam">oldname</span><span class="op">=</span><span class="str">'account_collected_id'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t604" class="run"><span class="n"><a href="#t604">604</a></span><span class="t">    <span class="nam">refund_account_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'account.account'</span><span class="op">,</span> <span class="nam">domain</span><span class="op">=</span><span class="op">[</span><span class="op">(</span><span class="str">'deprecated'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="nam">False</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Tax Account on Refunds'</span><span class="op">,</span> <span class="nam">ondelete</span><span class="op">=</span><span class="str">'restrict'</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t605" class="pln"><span class="n"><a href="#t605">605</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"Account that will be set on invoice tax lines for refunds. Leave empty to use the expense account."</span><span class="op">,</span> <span class="nam">oldname</span><span class="op">=</span><span class="str">'account_paid_id'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t606" class="run"><span class="n"><a href="#t606">606</a></span><span class="t">    <span class="nam">description</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Char</span><span class="op">(</span><span class="nam">string</span><span class="op">=</span><span class="str">'Label on Invoices'</span><span class="op">,</span> <span class="nam">translate</span><span class="op">=</span><span class="nam">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t607" class="run"><span class="n"><a href="#t607">607</a></span><span class="t">    <span class="nam">price_include</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Boolean</span><span class="op">(</span><span class="nam">string</span><span class="op">=</span><span class="str">'Included in Price'</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t608" class="pln"><span class="n"><a href="#t608">608</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"Check this if the price you use on the product and invoices includes this tax."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t609" class="run"><span class="n"><a href="#t609">609</a></span><span class="t">    <span class="nam">include_base_amount</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Boolean</span><span class="op">(</span><span class="nam">string</span><span class="op">=</span><span class="str">'Affect Base of Subsequent Taxes'</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t610" class="pln"><span class="n"><a href="#t610">610</a></span><span class="t">        <span class="nam">help</span><span class="op">=</span><span class="str">"If set, taxes which are computed after this one will be computed based on the price tax included."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t611" class="run"><span class="n"><a href="#t611">611</a></span><span class="t">    <span class="nam">analytic</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Boolean</span><span class="op">(</span><span class="nam">string</span><span class="op">=</span><span class="str">"Include in Analytic Cost"</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"If set, the amount computed by this tax will be assigned to the same analytic account as the invoice line (if any)"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t612" class="run"><span class="n"><a href="#t612">612</a></span><span class="t">    <span class="nam">tag_ids</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2many</span><span class="op">(</span><span class="str">'account.account.tag'</span><span class="op">,</span> <span class="str">'account_tax_account_tag'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Tags'</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Optional tags you may want to assign for custom reporting"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t613" class="run"><span class="n"><a href="#t613">613</a></span><span class="t">    <span class="nam">tax_group_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'account.tax.group'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">"Tax Group"</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">_default_tax_group</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t614" class="pln"><span class="n"><a href="#t614">614</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t615" class="run"><span class="n"><a href="#t615">615</a></span><span class="t">    <span class="nam">_sql_constraints</span> <span class="op">=</span> <span class="op">[</span>&nbsp;</span><span class="r"></span></p>
    <p id="t616" class="pln"><span class="n"><a href="#t616">616</a></span><span class="t">        <span class="op">(</span><span class="str">'name_company_uniq'</span><span class="op">,</span> <span class="str">'unique(name, company_id, type_tax_use)'</span><span class="op">,</span> <span class="str">'Tax names must be unique !'</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t617" class="pln"><span class="n"><a href="#t617">617</a></span><span class="t">    <span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t618" class="pln"><span class="n"><a href="#t618">618</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t619" class="run"><span class="n"><a href="#t619">619</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">multi</span>&nbsp;</span><span class="r"></span></p>
    <p id="t620" class="pln"><span class="n"><a href="#t620">620</a></span><span class="t">    <span class="key">def</span> <span class="nam">unlink</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t621" class="mis show_mis"><span class="n"><a href="#t621">621</a></span><span class="t">        <span class="nam">company_id</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">user</span><span class="op">.</span><span class="nam">company_id</span><span class="op">.</span><span class="nam">id</span>&nbsp;</span><span class="r"></span></p>
    <p id="t622" class="mis show_mis"><span class="n"><a href="#t622">622</a></span><span class="t">        <span class="nam">ir_values</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'ir.values'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t623" class="mis show_mis"><span class="n"><a href="#t623">623</a></span><span class="t">        <span class="nam">supplier_taxes_id</span> <span class="op">=</span> <span class="nam">set</span><span class="op">(</span><span class="nam">ir_values</span><span class="op">.</span><span class="nam">get_default</span><span class="op">(</span><span class="str">'product.template'</span><span class="op">,</span> <span class="str">'supplier_taxes_id'</span><span class="op">,</span> <span class="nam">company_id</span><span class="op">=</span><span class="nam">company_id</span><span class="op">)</span> <span class="key">or</span> <span class="op">[</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t624" class="mis show_mis"><span class="n"><a href="#t624">624</a></span><span class="t">        <span class="nam">deleted_sup_tax</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">filtered</span><span class="op">(</span><span class="key">lambda</span> <span class="nam">tax</span><span class="op">:</span> <span class="nam">tax</span><span class="op">.</span><span class="nam">id</span> <span class="key">in</span> <span class="nam">supplier_taxes_id</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t625" class="mis show_mis"><span class="n"><a href="#t625">625</a></span><span class="t">        <span class="key">if</span> <span class="nam">deleted_sup_tax</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t626" class="mis show_mis"><span class="n"><a href="#t626">626</a></span><span class="t">            <span class="nam">ir_values</span><span class="op">.</span><span class="nam">sudo</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">set_default</span><span class="op">(</span><span class="str">'product.template'</span><span class="op">,</span> <span class="str">"supplier_taxes_id"</span><span class="op">,</span> <span class="nam">list</span><span class="op">(</span><span class="nam">supplier_taxes_id</span> <span class="op">-</span> <span class="nam">set</span><span class="op">(</span><span class="nam">deleted_sup_tax</span><span class="op">.</span><span class="nam">ids</span><span class="op">)</span><span class="op">)</span><span class="op">,</span> <span class="nam">for_all_users</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">company_id</span><span class="op">=</span><span class="nam">company_id</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t627" class="mis show_mis"><span class="n"><a href="#t627">627</a></span><span class="t">        <span class="nam">taxes_id</span> <span class="op">=</span> <span class="nam">set</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'ir.values'</span><span class="op">]</span><span class="op">.</span><span class="nam">get_default</span><span class="op">(</span><span class="str">'product.template'</span><span class="op">,</span> <span class="str">'taxes_id'</span><span class="op">,</span> <span class="nam">company_id</span><span class="op">=</span><span class="nam">company_id</span><span class="op">)</span> <span class="key">or</span> <span class="op">[</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t628" class="mis show_mis"><span class="n"><a href="#t628">628</a></span><span class="t">        <span class="nam">deleted_tax</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">filtered</span><span class="op">(</span><span class="key">lambda</span> <span class="nam">tax</span><span class="op">:</span> <span class="nam">tax</span><span class="op">.</span><span class="nam">id</span> <span class="key">in</span> <span class="nam">taxes_id</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t629" class="mis show_mis"><span class="n"><a href="#t629">629</a></span><span class="t">        <span class="key">if</span> <span class="nam">deleted_tax</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t630" class="mis show_mis"><span class="n"><a href="#t630">630</a></span><span class="t">            <span class="nam">ir_values</span><span class="op">.</span><span class="nam">sudo</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">set_default</span><span class="op">(</span><span class="str">'product.template'</span><span class="op">,</span> <span class="str">"taxes_id"</span><span class="op">,</span> <span class="nam">list</span><span class="op">(</span><span class="nam">taxes_id</span> <span class="op">-</span> <span class="nam">set</span><span class="op">(</span><span class="nam">deleted_tax</span><span class="op">.</span><span class="nam">ids</span><span class="op">)</span><span class="op">)</span><span class="op">,</span> <span class="nam">for_all_users</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">company_id</span><span class="op">=</span><span class="nam">company_id</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t631" class="mis show_mis"><span class="n"><a href="#t631">631</a></span><span class="t">        <span class="key">return</span> <span class="nam">super</span><span class="op">(</span><span class="nam">AccountTax</span><span class="op">,</span> <span class="nam">self</span><span class="op">)</span><span class="op">.</span><span class="nam">unlink</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t632" class="pln"><span class="n"><a href="#t632">632</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t633" class="run"><span class="n"><a href="#t633">633</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">one</span>&nbsp;</span><span class="r"></span></p>
    <p id="t634" class="run"><span class="n"><a href="#t634">634</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">constrains</span><span class="op">(</span><span class="str">'children_tax_ids'</span><span class="op">,</span> <span class="str">'type_tax_use'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t635" class="pln"><span class="n"><a href="#t635">635</a></span><span class="t">    <span class="key">def</span> <span class="nam">_check_children_scope</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t636" class="mis show_mis"><span class="n"><a href="#t636">636</a></span><span class="t">        <span class="key">if</span> <span class="key">not</span> <span class="nam">all</span><span class="op">(</span><span class="nam">child</span><span class="op">.</span><span class="nam">type_tax_use</span> <span class="key">in</span> <span class="op">(</span><span class="str">'none'</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">type_tax_use</span><span class="op">)</span> <span class="key">for</span> <span class="nam">child</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">children_tax_ids</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t637" class="mis show_mis"><span class="n"><a href="#t637">637</a></span><span class="t">            <span class="key">raise</span> <span class="nam">ValidationError</span><span class="op">(</span><span class="nam">_</span><span class="op">(</span><span class="str">'The application scope of taxes in a group must be either the same as the group or "None".'</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t638" class="pln"><span class="n"><a href="#t638">638</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t639" class="run"><span class="n"><a href="#t639">639</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">one</span>&nbsp;</span><span class="r"></span></p>
    <p id="t640" class="run"><span class="n"><a href="#t640">640</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">returns</span><span class="op">(</span><span class="str">'self'</span><span class="op">,</span> <span class="key">lambda</span> <span class="nam">value</span><span class="op">:</span> <span class="nam">value</span><span class="op">.</span><span class="nam">id</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t641" class="run"><span class="n"><a href="#t641">641</a></span><span class="t">    <span class="key">def</span> <span class="nam">copy</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t642" class="mis show_mis"><span class="n"><a href="#t642">642</a></span><span class="t">        <span class="nam">default</span> <span class="op">=</span> <span class="nam">dict</span><span class="op">(</span><span class="nam">default</span> <span class="key">or</span> <span class="op">{</span><span class="op">}</span><span class="op">,</span> <span class="nam">name</span><span class="op">=</span><span class="nam">_</span><span class="op">(</span><span class="str">"%s (Copy)"</span><span class="op">)</span> <span class="op">%</span> <span class="nam">self</span><span class="op">.</span><span class="nam">name</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t643" class="mis show_mis"><span class="n"><a href="#t643">643</a></span><span class="t">        <span class="key">return</span> <span class="nam">super</span><span class="op">(</span><span class="nam">AccountTax</span><span class="op">,</span> <span class="nam">self</span><span class="op">)</span><span class="op">.</span><span class="nam">copy</span><span class="op">(</span><span class="nam">default</span><span class="op">=</span><span class="nam">default</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t644" class="pln"><span class="n"><a href="#t644">644</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t645" class="run"><span class="n"><a href="#t645">645</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">model</span>&nbsp;</span><span class="r"></span></p>
    <p id="t646" class="run"><span class="n"><a href="#t646">646</a></span><span class="t">    <span class="key">def</span> <span class="nam">name_search</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">name</span><span class="op">,</span> <span class="nam">args</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">operator</span><span class="op">=</span><span class="str">'ilike'</span><span class="op">,</span> <span class="nam">limit</span><span class="op">=</span><span class="num">80</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t647" class="pln"><span class="n"><a href="#t647">647</a></span><span class="t">        <span class="str">""" Returns a list of tupples containing id, name, as internally it is called {def name_get}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t648" class="pln"><span class="n"><a href="#t648">648</a></span><span class="t"><span class="str">            result format: {[(id, name), (id, name), ...]}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t649" class="pln"><span class="n"><a href="#t649">649</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t650" class="mis show_mis"><span class="n"><a href="#t650">650</a></span><span class="t">        <span class="nam">args</span> <span class="op">=</span> <span class="nam">args</span> <span class="key">or</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t651" class="mis show_mis"><span class="n"><a href="#t651">651</a></span><span class="t">        <span class="key">if</span> <span class="nam">operator</span> <span class="key">in</span> <span class="nam">expression</span><span class="op">.</span><span class="nam">NEGATIVE_TERM_OPERATORS</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t652" class="mis show_mis"><span class="n"><a href="#t652">652</a></span><span class="t">            <span class="nam">domain</span> <span class="op">=</span> <span class="op">[</span><span class="op">(</span><span class="str">'description'</span><span class="op">,</span> <span class="nam">operator</span><span class="op">,</span> <span class="nam">name</span><span class="op">)</span><span class="op">,</span> <span class="op">(</span><span class="str">'name'</span><span class="op">,</span> <span class="nam">operator</span><span class="op">,</span> <span class="nam">name</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t653" class="pln"><span class="n"><a href="#t653">653</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t654" class="mis show_mis"><span class="n"><a href="#t654">654</a></span><span class="t">            <span class="nam">domain</span> <span class="op">=</span> <span class="op">[</span><span class="str">'|'</span><span class="op">,</span> <span class="op">(</span><span class="str">'description'</span><span class="op">,</span> <span class="nam">operator</span><span class="op">,</span> <span class="nam">name</span><span class="op">)</span><span class="op">,</span> <span class="op">(</span><span class="str">'name'</span><span class="op">,</span> <span class="nam">operator</span><span class="op">,</span> <span class="nam">name</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t655" class="mis show_mis"><span class="n"><a href="#t655">655</a></span><span class="t">        <span class="nam">taxes</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">search</span><span class="op">(</span><span class="nam">expression</span><span class="op">.</span><span class="nam">AND</span><span class="op">(</span><span class="op">[</span><span class="nam">domain</span><span class="op">,</span> <span class="nam">args</span><span class="op">]</span><span class="op">)</span><span class="op">,</span> <span class="nam">limit</span><span class="op">=</span><span class="nam">limit</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t656" class="mis show_mis"><span class="n"><a href="#t656">656</a></span><span class="t">        <span class="key">return</span> <span class="nam">taxes</span><span class="op">.</span><span class="nam">name_get</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t657" class="pln"><span class="n"><a href="#t657">657</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t658" class="run"><span class="n"><a href="#t658">658</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">model</span>&nbsp;</span><span class="r"></span></p>
    <p id="t659" class="run"><span class="n"><a href="#t659">659</a></span><span class="t">    <span class="key">def</span> <span class="nam">search</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">args</span><span class="op">,</span> <span class="nam">offset</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">limit</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">order</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">count</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t660" class="mis show_mis"><span class="n"><a href="#t660">660</a></span><span class="t">        <span class="nam">context</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_context</span> <span class="key">or</span> <span class="op">{</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t661" class="pln"><span class="n"><a href="#t661">661</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t662" class="mis show_mis"><span class="n"><a href="#t662">662</a></span><span class="t">        <span class="key">if</span> <span class="nam">context</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'type'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t663" class="mis show_mis"><span class="n"><a href="#t663">663</a></span><span class="t">            <span class="key">if</span> <span class="nam">context</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'type'</span><span class="op">)</span> <span class="key">in</span> <span class="op">(</span><span class="str">'out_invoice'</span><span class="op">,</span> <span class="str">'out_refund'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t664" class="mis show_mis"><span class="n"><a href="#t664">664</a></span><span class="t">                <span class="nam">args</span> <span class="op">+=</span> <span class="op">[</span><span class="op">(</span><span class="str">'type_tax_use'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="str">'sale'</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t665" class="mis show_mis"><span class="n"><a href="#t665">665</a></span><span class="t">            <span class="key">elif</span> <span class="nam">context</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'type'</span><span class="op">)</span> <span class="key">in</span> <span class="op">(</span><span class="str">'in_invoice'</span><span class="op">,</span> <span class="str">'in_refund'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t666" class="mis show_mis"><span class="n"><a href="#t666">666</a></span><span class="t">                <span class="nam">args</span> <span class="op">+=</span> <span class="op">[</span><span class="op">(</span><span class="str">'type_tax_use'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="str">'purchase'</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t667" class="pln"><span class="n"><a href="#t667">667</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t668" class="mis show_mis"><span class="n"><a href="#t668">668</a></span><span class="t">        <span class="key">if</span> <span class="nam">context</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'journal_id'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t669" class="mis show_mis"><span class="n"><a href="#t669">669</a></span><span class="t">            <span class="nam">journal</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'account.journal'</span><span class="op">]</span><span class="op">.</span><span class="nam">browse</span><span class="op">(</span><span class="nam">context</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'journal_id'</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t670" class="mis show_mis"><span class="n"><a href="#t670">670</a></span><span class="t">            <span class="key">if</span> <span class="nam">journal</span><span class="op">.</span><span class="nam">type</span> <span class="key">in</span> <span class="op">(</span><span class="str">'sale'</span><span class="op">,</span> <span class="str">'purchase'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t671" class="mis show_mis"><span class="n"><a href="#t671">671</a></span><span class="t">                <span class="nam">args</span> <span class="op">+=</span> <span class="op">[</span><span class="op">(</span><span class="str">'type_tax_use'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="nam">journal</span><span class="op">.</span><span class="nam">type</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t672" class="pln"><span class="n"><a href="#t672">672</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t673" class="mis show_mis"><span class="n"><a href="#t673">673</a></span><span class="t">        <span class="key">return</span> <span class="nam">super</span><span class="op">(</span><span class="nam">AccountTax</span><span class="op">,</span> <span class="nam">self</span><span class="op">)</span><span class="op">.</span><span class="nam">search</span><span class="op">(</span><span class="nam">args</span><span class="op">,</span> <span class="nam">offset</span><span class="op">,</span> <span class="nam">limit</span><span class="op">,</span> <span class="nam">order</span><span class="op">,</span> <span class="nam">count</span><span class="op">=</span><span class="nam">count</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t674" class="pln"><span class="n"><a href="#t674">674</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t675" class="run"><span class="n"><a href="#t675">675</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">onchange</span><span class="op">(</span><span class="str">'amount'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t676" class="pln"><span class="n"><a href="#t676">676</a></span><span class="t">    <span class="key">def</span> <span class="nam">onchange_amount</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t677" class="mis show_mis"><span class="n"><a href="#t677">677</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">amount_type</span> <span class="key">in</span> <span class="op">(</span><span class="str">'percent'</span><span class="op">,</span> <span class="str">'division'</span><span class="op">)</span> <span class="key">and</span> <span class="nam">self</span><span class="op">.</span><span class="nam">amount</span> <span class="op">!=</span> <span class="num">0.0</span> <span class="key">and</span> <span class="key">not</span> <span class="nam">self</span><span class="op">.</span><span class="nam">description</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t678" class="mis show_mis"><span class="n"><a href="#t678">678</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">description</span> <span class="op">=</span> <span class="str">"{0:.4g}%"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">amount</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t679" class="pln"><span class="n"><a href="#t679">679</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t680" class="run"><span class="n"><a href="#t680">680</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">onchange</span><span class="op">(</span><span class="str">'account_id'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t681" class="pln"><span class="n"><a href="#t681">681</a></span><span class="t">    <span class="key">def</span> <span class="nam">onchange_account_id</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t682" class="mis show_mis"><span class="n"><a href="#t682">682</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">refund_account_id</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">account_id</span>&nbsp;</span><span class="r"></span></p>
    <p id="t683" class="pln"><span class="n"><a href="#t683">683</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t684" class="run"><span class="n"><a href="#t684">684</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">onchange</span><span class="op">(</span><span class="str">'price_include'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t685" class="pln"><span class="n"><a href="#t685">685</a></span><span class="t">    <span class="key">def</span> <span class="nam">onchange_price_include</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t686" class="mis show_mis"><span class="n"><a href="#t686">686</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">price_include</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t687" class="mis show_mis"><span class="n"><a href="#t687">687</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">include_base_amount</span> <span class="op">=</span> <span class="nam">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t688" class="pln"><span class="n"><a href="#t688">688</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t689" class="run"><span class="n"><a href="#t689">689</a></span><span class="t">    <span class="key">def</span> <span class="nam">get_grouping_key</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">invoice_tax_val</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t690" class="pln"><span class="n"><a href="#t690">690</a></span><span class="t">        <span class="str">""" Returns a string that will be used to group account.invoice.tax sharing the same properties"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t691" class="mis show_mis"><span class="n"><a href="#t691">691</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">ensure_one</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t692" class="mis show_mis"><span class="n"><a href="#t692">692</a></span><span class="t">        <span class="key">return</span> <span class="nam">str</span><span class="op">(</span><span class="nam">invoice_tax_val</span><span class="op">[</span><span class="str">'tax_id'</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="str">'-'</span> <span class="op">+</span> <span class="nam">str</span><span class="op">(</span><span class="nam">invoice_tax_val</span><span class="op">[</span><span class="str">'account_id'</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="str">'-'</span> <span class="op">+</span> <span class="nam">str</span><span class="op">(</span><span class="nam">invoice_tax_val</span><span class="op">[</span><span class="str">'account_analytic_id'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t693" class="pln"><span class="n"><a href="#t693">693</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t694" class="run"><span class="n"><a href="#t694">694</a></span><span class="t">    <span class="key">def</span> <span class="nam">_compute_amount</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">base_amount</span><span class="op">,</span> <span class="nam">price_unit</span><span class="op">,</span> <span class="nam">quantity</span><span class="op">=</span><span class="num">1.0</span><span class="op">,</span> <span class="nam">product</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">partner</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t695" class="pln"><span class="n"><a href="#t695">695</a></span><span class="t">        <span class="str">""" Returns the amount of a single tax. base_amount is the actual amount on which the tax is applied, which is</span>&nbsp;</span><span class="r"></span></p>
    <p id="t696" class="pln"><span class="n"><a href="#t696">696</a></span><span class="t"><span class="str">            price_unit * quantity eventually affected by previous taxes (if tax is include_base_amount XOR price_include)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t697" class="pln"><span class="n"><a href="#t697">697</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t698" class="mis show_mis"><span class="n"><a href="#t698">698</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">ensure_one</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t699" class="mis show_mis"><span class="n"><a href="#t699">699</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">amount_type</span> <span class="op">==</span> <span class="str">'fixed'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t700" class="pln"><span class="n"><a href="#t700">700</a></span><span class="t">            <span class="com"># Use copysign to take into account the sign of the base amount which includes the sign</span>&nbsp;</span><span class="r"></span></p>
    <p id="t701" class="pln"><span class="n"><a href="#t701">701</a></span><span class="t">            <span class="com"># of the quantity and the sign of the price_unit</span>&nbsp;</span><span class="r"></span></p>
    <p id="t702" class="pln"><span class="n"><a href="#t702">702</a></span><span class="t">            <span class="com"># Amount is the fixed price for the tax, it can be negative</span>&nbsp;</span><span class="r"></span></p>
    <p id="t703" class="pln"><span class="n"><a href="#t703">703</a></span><span class="t">            <span class="com"># Base amount included the sign of the quantity and the sign of the unit price and when</span>&nbsp;</span><span class="r"></span></p>
    <p id="t704" class="pln"><span class="n"><a href="#t704">704</a></span><span class="t">            <span class="com"># a product is returned, it can be done either by changing the sign of quantity or by changing the</span>&nbsp;</span><span class="r"></span></p>
    <p id="t705" class="pln"><span class="n"><a href="#t705">705</a></span><span class="t">            <span class="com"># sign of the price unit.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t706" class="pln"><span class="n"><a href="#t706">706</a></span><span class="t">            <span class="com"># When the price unit is equal to 0, the sign of the quantity is absorbed in base_amount then</span>&nbsp;</span><span class="r"></span></p>
    <p id="t707" class="pln"><span class="n"><a href="#t707">707</a></span><span class="t">            <span class="com"># a "else" case is needed.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t708" class="mis show_mis"><span class="n"><a href="#t708">708</a></span><span class="t">            <span class="key">if</span> <span class="nam">base_amount</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t709" class="mis show_mis"><span class="n"><a href="#t709">709</a></span><span class="t">                <span class="key">return</span> <span class="nam">math</span><span class="op">.</span><span class="nam">copysign</span><span class="op">(</span><span class="nam">quantity</span><span class="op">,</span> <span class="nam">base_amount</span><span class="op">)</span> <span class="op">*</span> <span class="nam">self</span><span class="op">.</span><span class="nam">amount</span>&nbsp;</span><span class="r"></span></p>
    <p id="t710" class="pln"><span class="n"><a href="#t710">710</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t711" class="mis show_mis"><span class="n"><a href="#t711">711</a></span><span class="t">                <span class="key">return</span> <span class="nam">quantity</span> <span class="op">*</span> <span class="nam">self</span><span class="op">.</span><span class="nam">amount</span>&nbsp;</span><span class="r"></span></p>
    <p id="t712" class="mis show_mis"><span class="n"><a href="#t712">712</a></span><span class="t">        <span class="key">if</span> <span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">amount_type</span> <span class="op">==</span> <span class="str">'percent'</span> <span class="key">and</span> <span class="key">not</span> <span class="nam">self</span><span class="op">.</span><span class="nam">price_include</span><span class="op">)</span> <span class="key">or</span> <span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">amount_type</span> <span class="op">==</span> <span class="str">'division'</span> <span class="key">and</span> <span class="nam">self</span><span class="op">.</span><span class="nam">price_include</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t713" class="mis show_mis"><span class="n"><a href="#t713">713</a></span><span class="t">            <span class="key">return</span> <span class="nam">base_amount</span> <span class="op">*</span> <span class="nam">self</span><span class="op">.</span><span class="nam">amount</span> <span class="op">/</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p id="t714" class="mis show_mis"><span class="n"><a href="#t714">714</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">amount_type</span> <span class="op">==</span> <span class="str">'percent'</span> <span class="key">and</span> <span class="nam">self</span><span class="op">.</span><span class="nam">price_include</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t715" class="mis show_mis"><span class="n"><a href="#t715">715</a></span><span class="t">            <span class="key">return</span> <span class="nam">base_amount</span> <span class="op">-</span> <span class="op">(</span><span class="nam">base_amount</span> <span class="op">/</span> <span class="op">(</span><span class="num">1</span> <span class="op">+</span> <span class="nam">self</span><span class="op">.</span><span class="nam">amount</span> <span class="op">/</span> <span class="num">100</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t716" class="mis show_mis"><span class="n"><a href="#t716">716</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">amount_type</span> <span class="op">==</span> <span class="str">'division'</span> <span class="key">and</span> <span class="key">not</span> <span class="nam">self</span><span class="op">.</span><span class="nam">price_include</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t717" class="mis show_mis"><span class="n"><a href="#t717">717</a></span><span class="t">            <span class="key">return</span> <span class="nam">base_amount</span> <span class="op">/</span> <span class="op">(</span><span class="num">1</span> <span class="op">-</span> <span class="nam">self</span><span class="op">.</span><span class="nam">amount</span> <span class="op">/</span> <span class="num">100</span><span class="op">)</span> <span class="op">-</span> <span class="nam">base_amount</span>&nbsp;</span><span class="r"></span></p>
    <p id="t718" class="pln"><span class="n"><a href="#t718">718</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t719" class="run"><span class="n"><a href="#t719">719</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">multi</span>&nbsp;</span><span class="r"></span></p>
    <p id="t720" class="run"><span class="n"><a href="#t720">720</a></span><span class="t">    <span class="key">def</span> <span class="nam">json_friendly_compute_all</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">price_unit</span><span class="op">,</span> <span class="nam">currency_id</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">quantity</span><span class="op">=</span><span class="num">1.0</span><span class="op">,</span> <span class="nam">product_id</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">partner_id</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t721" class="pln"><span class="n"><a href="#t721">721</a></span><span class="t">        <span class="str">""" Just converts parameters in browse records and calls for compute_all, because js widgets can't serialize browse records """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t722" class="mis show_mis"><span class="n"><a href="#t722">722</a></span><span class="t">        <span class="key">if</span> <span class="nam">currency_id</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t723" class="mis show_mis"><span class="n"><a href="#t723">723</a></span><span class="t">            <span class="nam">currency_id</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'res.currency'</span><span class="op">]</span><span class="op">.</span><span class="nam">browse</span><span class="op">(</span><span class="nam">currency_id</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t724" class="mis show_mis"><span class="n"><a href="#t724">724</a></span><span class="t">        <span class="key">if</span> <span class="nam">product_id</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t725" class="mis show_mis"><span class="n"><a href="#t725">725</a></span><span class="t">            <span class="nam">product_id</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'product.product'</span><span class="op">]</span><span class="op">.</span><span class="nam">browse</span><span class="op">(</span><span class="nam">product_id</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t726" class="mis show_mis"><span class="n"><a href="#t726">726</a></span><span class="t">        <span class="key">if</span> <span class="nam">partner_id</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t727" class="mis show_mis"><span class="n"><a href="#t727">727</a></span><span class="t">            <span class="nam">partner_id</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">[</span><span class="str">'res.partner'</span><span class="op">]</span><span class="op">.</span><span class="nam">browse</span><span class="op">(</span><span class="nam">partner_id</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t728" class="mis show_mis"><span class="n"><a href="#t728">728</a></span><span class="t">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">compute_all</span><span class="op">(</span><span class="nam">price_unit</span><span class="op">,</span> <span class="nam">currency</span><span class="op">=</span><span class="nam">currency_id</span><span class="op">,</span> <span class="nam">quantity</span><span class="op">=</span><span class="nam">quantity</span><span class="op">,</span> <span class="nam">product</span><span class="op">=</span><span class="nam">product_id</span><span class="op">,</span> <span class="nam">partner</span><span class="op">=</span><span class="nam">partner_id</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t729" class="pln"><span class="n"><a href="#t729">729</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t730" class="run"><span class="n"><a href="#t730">730</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">multi</span>&nbsp;</span><span class="r"></span></p>
    <p id="t731" class="run"><span class="n"><a href="#t731">731</a></span><span class="t">    <span class="key">def</span> <span class="nam">compute_all</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">price_unit</span><span class="op">,</span> <span class="nam">currency</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">quantity</span><span class="op">=</span><span class="num">1.0</span><span class="op">,</span> <span class="nam">product</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">partner</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t732" class="pln"><span class="n"><a href="#t732">732</a></span><span class="t">        <span class="str">""" Returns all information required to apply taxes (in self + their children in case of a tax goup).</span>&nbsp;</span><span class="r"></span></p>
    <p id="t733" class="pln"><span class="n"><a href="#t733">733</a></span><span class="t"><span class="str">            We consider the sequence of the parent for group of taxes.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t734" class="pln"><span class="n"><a href="#t734">734</a></span><span class="t"><span class="str">                Eg. considering letters as taxes and alphabetic order as sequence :</span>&nbsp;</span><span class="r"></span></p>
    <p id="t735" class="pln"><span class="n"><a href="#t735">735</a></span><span class="t"><span class="str">                [G, B([A, D, F]), E, C] will be computed as [A, D, F, C, E, G]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t736" class="pln"><span class="n"><a href="#t736">736</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t737" class="pln"><span class="n"><a href="#t737">737</a></span><span class="t"><span class="str">        RETURN: {</span>&nbsp;</span><span class="r"></span></p>
    <p id="t738" class="pln"><span class="n"><a href="#t738">738</a></span><span class="t"><span class="str">            'total_excluded': 0.0,    # Total without taxes</span>&nbsp;</span><span class="r"></span></p>
    <p id="t739" class="pln"><span class="n"><a href="#t739">739</a></span><span class="t"><span class="str">            'total_included': 0.0,    # Total with taxes</span>&nbsp;</span><span class="r"></span></p>
    <p id="t740" class="pln"><span class="n"><a href="#t740">740</a></span><span class="t"><span class="str">            'taxes': [{               # One dict for each tax in self and their children</span>&nbsp;</span><span class="r"></span></p>
    <p id="t741" class="pln"><span class="n"><a href="#t741">741</a></span><span class="t"><span class="str">                'id': int,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t742" class="pln"><span class="n"><a href="#t742">742</a></span><span class="t"><span class="str">                'name': str,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t743" class="pln"><span class="n"><a href="#t743">743</a></span><span class="t"><span class="str">                'amount': float,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t744" class="pln"><span class="n"><a href="#t744">744</a></span><span class="t"><span class="str">                'sequence': int,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t745" class="pln"><span class="n"><a href="#t745">745</a></span><span class="t"><span class="str">                'account_id': int,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t746" class="pln"><span class="n"><a href="#t746">746</a></span><span class="t"><span class="str">                'refund_account_id': int,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t747" class="pln"><span class="n"><a href="#t747">747</a></span><span class="t"><span class="str">                'analytic': boolean,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t748" class="pln"><span class="n"><a href="#t748">748</a></span><span class="t"><span class="str">            }]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t749" class="pln"><span class="n"><a href="#t749">749</a></span><span class="t"><span class="str">        } """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t750" class="mis show_mis"><span class="n"><a href="#t750">750</a></span><span class="t">        <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t751" class="mis show_mis"><span class="n"><a href="#t751">751</a></span><span class="t">            <span class="nam">company_id</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">user</span><span class="op">.</span><span class="nam">company_id</span>&nbsp;</span><span class="r"></span></p>
    <p id="t752" class="pln"><span class="n"><a href="#t752">752</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t753" class="mis show_mis"><span class="n"><a href="#t753">753</a></span><span class="t">            <span class="nam">company_id</span> <span class="op">=</span> <span class="nam">self</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">company_id</span>&nbsp;</span><span class="r"></span></p>
    <p id="t754" class="mis show_mis"><span class="n"><a href="#t754">754</a></span><span class="t">        <span class="key">if</span> <span class="key">not</span> <span class="nam">currency</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t755" class="mis show_mis"><span class="n"><a href="#t755">755</a></span><span class="t">            <span class="nam">currency</span> <span class="op">=</span> <span class="nam">company_id</span><span class="op">.</span><span class="nam">currency_id</span>&nbsp;</span><span class="r"></span></p>
    <p id="t756" class="mis show_mis"><span class="n"><a href="#t756">756</a></span><span class="t">        <span class="nam">taxes</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t757" class="pln"><span class="n"><a href="#t757">757</a></span><span class="t">        <span class="com"># By default, for each tax, tax amount will first be computed</span>&nbsp;</span><span class="r"></span></p>
    <p id="t758" class="pln"><span class="n"><a href="#t758">758</a></span><span class="t">        <span class="com"># and rounded at the 'Account' decimal precision for each</span>&nbsp;</span><span class="r"></span></p>
    <p id="t759" class="pln"><span class="n"><a href="#t759">759</a></span><span class="t">        <span class="com"># PO/SO/invoice line and then these rounded amounts will be</span>&nbsp;</span><span class="r"></span></p>
    <p id="t760" class="pln"><span class="n"><a href="#t760">760</a></span><span class="t">        <span class="com"># summed, leading to the total amount for that tax. But, if the</span>&nbsp;</span><span class="r"></span></p>
    <p id="t761" class="pln"><span class="n"><a href="#t761">761</a></span><span class="t">        <span class="com"># company has tax_calculation_rounding_method = round_globally,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t762" class="pln"><span class="n"><a href="#t762">762</a></span><span class="t">        <span class="com"># we still follow the same method, but we use a much larger</span>&nbsp;</span><span class="r"></span></p>
    <p id="t763" class="pln"><span class="n"><a href="#t763">763</a></span><span class="t">        <span class="com"># precision when we round the tax amount for each line (we use</span>&nbsp;</span><span class="r"></span></p>
    <p id="t764" class="pln"><span class="n"><a href="#t764">764</a></span><span class="t">        <span class="com"># the 'Account' decimal precision + 5), and that way it's like</span>&nbsp;</span><span class="r"></span></p>
    <p id="t765" class="pln"><span class="n"><a href="#t765">765</a></span><span class="t">        <span class="com"># rounding after the sum of the tax amounts of each line</span>&nbsp;</span><span class="r"></span></p>
    <p id="t766" class="mis show_mis"><span class="n"><a href="#t766">766</a></span><span class="t">        <span class="nam">prec</span> <span class="op">=</span> <span class="nam">currency</span><span class="op">.</span><span class="nam">decimal_places</span>&nbsp;</span><span class="r"></span></p>
    <p id="t767" class="pln"><span class="n"><a href="#t767">767</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t768" class="pln"><span class="n"><a href="#t768">768</a></span><span class="t">        <span class="com"># In some cases, it is necessary to force/prevent the rounding of the tax and the total</span>&nbsp;</span><span class="r"></span></p>
    <p id="t769" class="pln"><span class="n"><a href="#t769">769</a></span><span class="t">        <span class="com"># amounts. For example, in SO/PO line, we don't want to round the price unit at the</span>&nbsp;</span><span class="r"></span></p>
    <p id="t770" class="pln"><span class="n"><a href="#t770">770</a></span><span class="t">        <span class="com"># precision of the currency.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t771" class="pln"><span class="n"><a href="#t771">771</a></span><span class="t">        <span class="com"># The context key 'round' allows to force the standard behavior.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t772" class="mis show_mis"><span class="n"><a href="#t772">772</a></span><span class="t">        <span class="nam">round_tax</span> <span class="op">=</span> <span class="nam">False</span> <span class="key">if</span> <span class="nam">company_id</span><span class="op">.</span><span class="nam">tax_calculation_rounding_method</span> <span class="op">==</span> <span class="str">'round_globally'</span> <span class="key">else</span> <span class="nam">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t773" class="mis show_mis"><span class="n"><a href="#t773">773</a></span><span class="t">        <span class="nam">round_total</span> <span class="op">=</span> <span class="nam">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t774" class="mis show_mis"><span class="n"><a href="#t774">774</a></span><span class="t">        <span class="key">if</span> <span class="str">'round'</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">context</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t775" class="mis show_mis"><span class="n"><a href="#t775">775</a></span><span class="t">            <span class="nam">round_tax</span> <span class="op">=</span> <span class="nam">bool</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">context</span><span class="op">[</span><span class="str">'round'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t776" class="mis show_mis"><span class="n"><a href="#t776">776</a></span><span class="t">            <span class="nam">round_total</span> <span class="op">=</span> <span class="nam">bool</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">context</span><span class="op">[</span><span class="str">'round'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t777" class="pln"><span class="n"><a href="#t777">777</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t778" class="mis show_mis"><span class="n"><a href="#t778">778</a></span><span class="t">        <span class="key">if</span> <span class="key">not</span> <span class="nam">round_tax</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t779" class="mis show_mis"><span class="n"><a href="#t779">779</a></span><span class="t">            <span class="nam">prec</span> <span class="op">+=</span> <span class="num">5</span>&nbsp;</span><span class="r"></span></p>
    <p id="t780" class="pln"><span class="n"><a href="#t780">780</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t781" class="mis show_mis"><span class="n"><a href="#t781">781</a></span><span class="t">        <span class="nam">base_values</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">context</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'base_values'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t782" class="mis show_mis"><span class="n"><a href="#t782">782</a></span><span class="t">        <span class="key">if</span> <span class="key">not</span> <span class="nam">base_values</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t783" class="mis show_mis"><span class="n"><a href="#t783">783</a></span><span class="t">            <span class="nam">total_excluded</span> <span class="op">=</span> <span class="nam">total_included</span> <span class="op">=</span> <span class="nam">base</span> <span class="op">=</span> <span class="nam">round</span><span class="op">(</span><span class="nam">price_unit</span> <span class="op">*</span> <span class="nam">quantity</span><span class="op">,</span> <span class="nam">prec</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t784" class="pln"><span class="n"><a href="#t784">784</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t785" class="mis show_mis"><span class="n"><a href="#t785">785</a></span><span class="t">            <span class="nam">total_excluded</span><span class="op">,</span> <span class="nam">total_included</span><span class="op">,</span> <span class="nam">base</span> <span class="op">=</span> <span class="nam">base_values</span>&nbsp;</span><span class="r"></span></p>
    <p id="t786" class="pln"><span class="n"><a href="#t786">786</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t787" class="pln"><span class="n"><a href="#t787">787</a></span><span class="t">        <span class="com"># Sorting key is mandatory in this case. When no key is provided, sorted() will perform a</span>&nbsp;</span><span class="r"></span></p>
    <p id="t788" class="pln"><span class="n"><a href="#t788">788</a></span><span class="t">        <span class="com"># search. However, the search method is overridden in account.tax in order to add a domain</span>&nbsp;</span><span class="r"></span></p>
    <p id="t789" class="pln"><span class="n"><a href="#t789">789</a></span><span class="t">        <span class="com"># depending on the context. This domain might filter out some taxes from self, e.g. in the</span>&nbsp;</span><span class="r"></span></p>
    <p id="t790" class="pln"><span class="n"><a href="#t790">790</a></span><span class="t">        <span class="com"># case of group taxes.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t791" class="mis show_mis"><span class="n"><a href="#t791">791</a></span><span class="t">        <span class="key">for</span> <span class="nam">tax</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">sorted</span><span class="op">(</span><span class="nam">key</span><span class="op">=</span><span class="key">lambda</span> <span class="nam">r</span><span class="op">:</span> <span class="nam">r</span><span class="op">.</span><span class="nam">sequence</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t792" class="mis show_mis"><span class="n"><a href="#t792">792</a></span><span class="t">            <span class="key">if</span> <span class="nam">tax</span><span class="op">.</span><span class="nam">amount_type</span> <span class="op">==</span> <span class="str">'group'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t793" class="mis show_mis"><span class="n"><a href="#t793">793</a></span><span class="t">                <span class="nam">children</span> <span class="op">=</span> <span class="nam">tax</span><span class="op">.</span><span class="nam">children_tax_ids</span><span class="op">.</span><span class="nam">with_context</span><span class="op">(</span><span class="nam">base_values</span><span class="op">=</span><span class="op">(</span><span class="nam">total_excluded</span><span class="op">,</span> <span class="nam">total_included</span><span class="op">,</span> <span class="nam">base</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t794" class="mis show_mis"><span class="n"><a href="#t794">794</a></span><span class="t">                <span class="nam">ret</span> <span class="op">=</span> <span class="nam">children</span><span class="op">.</span><span class="nam">compute_all</span><span class="op">(</span><span class="nam">price_unit</span><span class="op">,</span> <span class="nam">currency</span><span class="op">,</span> <span class="nam">quantity</span><span class="op">,</span> <span class="nam">product</span><span class="op">,</span> <span class="nam">partner</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t795" class="mis show_mis"><span class="n"><a href="#t795">795</a></span><span class="t">                <span class="nam">total_excluded</span> <span class="op">=</span> <span class="nam">ret</span><span class="op">[</span><span class="str">'total_excluded'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t796" class="mis show_mis"><span class="n"><a href="#t796">796</a></span><span class="t">                <span class="nam">base</span> <span class="op">=</span> <span class="nam">ret</span><span class="op">[</span><span class="str">'base'</span><span class="op">]</span> <span class="key">if</span> <span class="nam">tax</span><span class="op">.</span><span class="nam">include_base_amount</span> <span class="key">else</span> <span class="nam">base</span>&nbsp;</span><span class="r"></span></p>
    <p id="t797" class="mis show_mis"><span class="n"><a href="#t797">797</a></span><span class="t">                <span class="nam">total_included</span> <span class="op">=</span> <span class="nam">ret</span><span class="op">[</span><span class="str">'total_included'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t798" class="mis show_mis"><span class="n"><a href="#t798">798</a></span><span class="t">                <span class="nam">tax_amount</span> <span class="op">=</span> <span class="nam">total_included</span> <span class="op">-</span> <span class="nam">total_excluded</span>&nbsp;</span><span class="r"></span></p>
    <p id="t799" class="mis show_mis"><span class="n"><a href="#t799">799</a></span><span class="t">                <span class="nam">taxes</span> <span class="op">+=</span> <span class="nam">ret</span><span class="op">[</span><span class="str">'taxes'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t800" class="mis show_mis"><span class="n"><a href="#t800">800</a></span><span class="t">                <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t801" class="pln"><span class="n"><a href="#t801">801</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t802" class="mis show_mis"><span class="n"><a href="#t802">802</a></span><span class="t">            <span class="nam">tax_amount</span> <span class="op">=</span> <span class="nam">tax</span><span class="op">.</span><span class="nam">_compute_amount</span><span class="op">(</span><span class="nam">base</span><span class="op">,</span> <span class="nam">price_unit</span><span class="op">,</span> <span class="nam">quantity</span><span class="op">,</span> <span class="nam">product</span><span class="op">,</span> <span class="nam">partner</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t803" class="mis show_mis"><span class="n"><a href="#t803">803</a></span><span class="t">            <span class="key">if</span> <span class="key">not</span> <span class="nam">round_tax</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t804" class="mis show_mis"><span class="n"><a href="#t804">804</a></span><span class="t">                <span class="nam">tax_amount</span> <span class="op">=</span> <span class="nam">round</span><span class="op">(</span><span class="nam">tax_amount</span><span class="op">,</span> <span class="nam">prec</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t805" class="pln"><span class="n"><a href="#t805">805</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t806" class="mis show_mis"><span class="n"><a href="#t806">806</a></span><span class="t">                <span class="nam">tax_amount</span> <span class="op">=</span> <span class="nam">currency</span><span class="op">.</span><span class="nam">round</span><span class="op">(</span><span class="nam">tax_amount</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t807" class="pln"><span class="n"><a href="#t807">807</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t808" class="mis show_mis"><span class="n"><a href="#t808">808</a></span><span class="t">            <span class="key">if</span> <span class="nam">tax</span><span class="op">.</span><span class="nam">price_include</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t809" class="mis show_mis"><span class="n"><a href="#t809">809</a></span><span class="t">                <span class="nam">total_excluded</span> <span class="op">-=</span> <span class="nam">tax_amount</span>&nbsp;</span><span class="r"></span></p>
    <p id="t810" class="mis show_mis"><span class="n"><a href="#t810">810</a></span><span class="t">                <span class="nam">base</span> <span class="op">-=</span> <span class="nam">tax_amount</span>&nbsp;</span><span class="r"></span></p>
    <p id="t811" class="pln"><span class="n"><a href="#t811">811</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t812" class="mis show_mis"><span class="n"><a href="#t812">812</a></span><span class="t">                <span class="nam">total_included</span> <span class="op">+=</span> <span class="nam">tax_amount</span>&nbsp;</span><span class="r"></span></p>
    <p id="t813" class="pln"><span class="n"><a href="#t813">813</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t814" class="pln"><span class="n"><a href="#t814">814</a></span><span class="t">            <span class="com"># Keep base amount used for the current tax</span>&nbsp;</span><span class="r"></span></p>
    <p id="t815" class="mis show_mis"><span class="n"><a href="#t815">815</a></span><span class="t">            <span class="nam">tax_base</span> <span class="op">=</span> <span class="nam">base</span>&nbsp;</span><span class="r"></span></p>
    <p id="t816" class="pln"><span class="n"><a href="#t816">816</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t817" class="mis show_mis"><span class="n"><a href="#t817">817</a></span><span class="t">            <span class="key">if</span> <span class="nam">tax</span><span class="op">.</span><span class="nam">include_base_amount</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t818" class="mis show_mis"><span class="n"><a href="#t818">818</a></span><span class="t">                <span class="nam">base</span> <span class="op">+=</span> <span class="nam">tax_amount</span>&nbsp;</span><span class="r"></span></p>
    <p id="t819" class="pln"><span class="n"><a href="#t819">819</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t820" class="mis show_mis"><span class="n"><a href="#t820">820</a></span><span class="t">            <span class="nam">taxes</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">{</span>&nbsp;</span><span class="r"></span></p>
    <p id="t821" class="pln"><span class="n"><a href="#t821">821</a></span><span class="t">                <span class="str">'id'</span><span class="op">:</span> <span class="nam">tax</span><span class="op">.</span><span class="nam">id</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t822" class="pln"><span class="n"><a href="#t822">822</a></span><span class="t">                <span class="str">'name'</span><span class="op">:</span> <span class="nam">tax</span><span class="op">.</span><span class="nam">with_context</span><span class="op">(</span><span class="op">**</span><span class="op">{</span><span class="str">'lang'</span><span class="op">:</span> <span class="nam">partner</span><span class="op">.</span><span class="nam">lang</span><span class="op">}</span> <span class="key">if</span> <span class="nam">partner</span> <span class="key">else</span> <span class="op">{</span><span class="op">}</span><span class="op">)</span><span class="op">.</span><span class="nam">name</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t823" class="pln"><span class="n"><a href="#t823">823</a></span><span class="t">                <span class="str">'amount'</span><span class="op">:</span> <span class="nam">tax_amount</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t824" class="pln"><span class="n"><a href="#t824">824</a></span><span class="t">                <span class="str">'base'</span><span class="op">:</span> <span class="nam">tax_base</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t825" class="pln"><span class="n"><a href="#t825">825</a></span><span class="t">                <span class="str">'sequence'</span><span class="op">:</span> <span class="nam">tax</span><span class="op">.</span><span class="nam">sequence</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t826" class="pln"><span class="n"><a href="#t826">826</a></span><span class="t">                <span class="str">'account_id'</span><span class="op">:</span> <span class="nam">tax</span><span class="op">.</span><span class="nam">account_id</span><span class="op">.</span><span class="nam">id</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t827" class="pln"><span class="n"><a href="#t827">827</a></span><span class="t">                <span class="str">'refund_account_id'</span><span class="op">:</span> <span class="nam">tax</span><span class="op">.</span><span class="nam">refund_account_id</span><span class="op">.</span><span class="nam">id</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t828" class="pln"><span class="n"><a href="#t828">828</a></span><span class="t">                <span class="str">'analytic'</span><span class="op">:</span> <span class="nam">tax</span><span class="op">.</span><span class="nam">analytic</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t829" class="pln"><span class="n"><a href="#t829">829</a></span><span class="t">            <span class="op">}</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t830" class="pln"><span class="n"><a href="#t830">830</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t831" class="mis show_mis"><span class="n"><a href="#t831">831</a></span><span class="t">        <span class="key">return</span> <span class="op">{</span>&nbsp;</span><span class="r"></span></p>
    <p id="t832" class="pln"><span class="n"><a href="#t832">832</a></span><span class="t">            <span class="str">'taxes'</span><span class="op">:</span> <span class="nam">sorted</span><span class="op">(</span><span class="nam">taxes</span><span class="op">,</span> <span class="nam">key</span><span class="op">=</span><span class="key">lambda</span> <span class="nam">k</span><span class="op">:</span> <span class="nam">k</span><span class="op">[</span><span class="str">'sequence'</span><span class="op">]</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t833" class="pln"><span class="n"><a href="#t833">833</a></span><span class="t">            <span class="str">'total_excluded'</span><span class="op">:</span> <span class="nam">currency</span><span class="op">.</span><span class="nam">round</span><span class="op">(</span><span class="nam">total_excluded</span><span class="op">)</span> <span class="key">if</span> <span class="nam">round_total</span> <span class="key">else</span> <span class="nam">total_excluded</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t834" class="pln"><span class="n"><a href="#t834">834</a></span><span class="t">            <span class="str">'total_included'</span><span class="op">:</span> <span class="nam">currency</span><span class="op">.</span><span class="nam">round</span><span class="op">(</span><span class="nam">total_included</span><span class="op">)</span> <span class="key">if</span> <span class="nam">round_total</span> <span class="key">else</span> <span class="nam">total_included</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t835" class="pln"><span class="n"><a href="#t835">835</a></span><span class="t">            <span class="str">'base'</span><span class="op">:</span> <span class="nam">base</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t836" class="pln"><span class="n"><a href="#t836">836</a></span><span class="t">        <span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t837" class="pln"><span class="n"><a href="#t837">837</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t838" class="run"><span class="n"><a href="#t838">838</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">model</span>&nbsp;</span><span class="r"></span></p>
    <p id="t839" class="pln"><span class="n"><a href="#t839">839</a></span><span class="t">    <span class="key">def</span> <span class="nam">_fix_tax_included_price</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">price</span><span class="op">,</span> <span class="nam">prod_taxes</span><span class="op">,</span> <span class="nam">line_taxes</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t840" class="pln"><span class="n"><a href="#t840">840</a></span><span class="t">        <span class="str">"""Subtract tax amount from price when corresponding "price included" taxes do not apply"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t841" class="pln"><span class="n"><a href="#t841">841</a></span><span class="t">        <span class="com"># FIXME get currency in param?</span>&nbsp;</span><span class="r"></span></p>
    <p id="t842" class="mis show_mis"><span class="n"><a href="#t842">842</a></span><span class="t">        <span class="nam">incl_tax</span> <span class="op">=</span> <span class="nam">prod_taxes</span><span class="op">.</span><span class="nam">filtered</span><span class="op">(</span><span class="key">lambda</span> <span class="nam">tax</span><span class="op">:</span> <span class="nam">tax</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">line_taxes</span> <span class="key">and</span> <span class="nam">tax</span><span class="op">.</span><span class="nam">price_include</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t843" class="mis show_mis"><span class="n"><a href="#t843">843</a></span><span class="t">        <span class="key">if</span> <span class="nam">incl_tax</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t844" class="mis show_mis"><span class="n"><a href="#t844">844</a></span><span class="t">            <span class="key">return</span> <span class="nam">incl_tax</span><span class="op">.</span><span class="nam">compute_all</span><span class="op">(</span><span class="nam">price</span><span class="op">)</span><span class="op">[</span><span class="str">'total_excluded'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t845" class="mis show_mis"><span class="n"><a href="#t845">845</a></span><span class="t">        <span class="key">return</span> <span class="nam">price</span>&nbsp;</span><span class="r"></span></p>
    <p id="t846" class="pln"><span class="n"><a href="#t846">846</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t847" class="run"><span class="n"><a href="#t847">847</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">model</span>&nbsp;</span><span class="r"></span></p>
    <p id="t848" class="pln"><span class="n"><a href="#t848">848</a></span><span class="t">    <span class="key">def</span> <span class="nam">_fix_tax_included_price_company</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">price</span><span class="op">,</span> <span class="nam">prod_taxes</span><span class="op">,</span> <span class="nam">line_taxes</span><span class="op">,</span> <span class="nam">company_id</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t849" class="mis show_mis"><span class="n"><a href="#t849">849</a></span><span class="t">        <span class="key">if</span> <span class="nam">company_id</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t850" class="pln"><span class="n"><a href="#t850">850</a></span><span class="t">            <span class="com">#To keep the same behavior as in _compute_tax_id</span>&nbsp;</span><span class="r"></span></p>
    <p id="t851" class="mis show_mis"><span class="n"><a href="#t851">851</a></span><span class="t">            <span class="nam">prod_taxes</span> <span class="op">=</span> <span class="nam">prod_taxes</span><span class="op">.</span><span class="nam">filtered</span><span class="op">(</span><span class="key">lambda</span> <span class="nam">tax</span><span class="op">:</span> <span class="nam">tax</span><span class="op">.</span><span class="nam">company_id</span> <span class="op">==</span> <span class="nam">company_id</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t852" class="mis show_mis"><span class="n"><a href="#t852">852</a></span><span class="t">            <span class="nam">line_taxes</span> <span class="op">=</span> <span class="nam">line_taxes</span><span class="op">.</span><span class="nam">filtered</span><span class="op">(</span><span class="key">lambda</span> <span class="nam">tax</span><span class="op">:</span> <span class="nam">tax</span><span class="op">.</span><span class="nam">company_id</span> <span class="op">==</span> <span class="nam">company_id</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t853" class="mis show_mis"><span class="n"><a href="#t853">853</a></span><span class="t">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_fix_tax_included_price</span><span class="op">(</span><span class="nam">price</span><span class="op">,</span> <span class="nam">prod_taxes</span><span class="op">,</span> <span class="nam">line_taxes</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t854" class="pln"><span class="n"><a href="#t854">854</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t855" class="run"><span class="n"><a href="#t855">855</a></span><span class="t"><span class="key">class</span> <span class="nam">AccountReconcileModel</span><span class="op">(</span><span class="nam">models</span><span class="op">.</span><span class="nam">Model</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t856" class="run"><span class="n"><a href="#t856">856</a></span><span class="t">    <span class="nam">_name</span> <span class="op">=</span> <span class="str">"account.reconcile.model"</span>&nbsp;</span><span class="r"></span></p>
    <p id="t857" class="run"><span class="n"><a href="#t857">857</a></span><span class="t">    <span class="nam">_description</span> <span class="op">=</span> <span class="str">"Preset to create journal entries during a invoices and payments matching"</span>&nbsp;</span><span class="r"></span></p>
    <p id="t858" class="pln"><span class="n"><a href="#t858">858</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t859" class="run"><span class="n"><a href="#t859">859</a></span><span class="t">    <span class="nam">name</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Char</span><span class="op">(</span><span class="nam">string</span><span class="op">=</span><span class="str">'Button Label'</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t860" class="run"><span class="n"><a href="#t860">860</a></span><span class="t">    <span class="nam">sequence</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Integer</span><span class="op">(</span><span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">10</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t861" class="run"><span class="n"><a href="#t861">861</a></span><span class="t">    <span class="nam">has_second_line</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Boolean</span><span class="op">(</span><span class="nam">string</span><span class="op">=</span><span class="str">'Add a second line'</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t862" class="run"><span class="n"><a href="#t862">862</a></span><span class="t">    <span class="nam">company_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'res.company'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Company'</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="key">lambda</span> <span class="nam">self</span><span class="op">:</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">user</span><span class="op">.</span><span class="nam">company_id</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t863" class="pln"><span class="n"><a href="#t863">863</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t864" class="run"><span class="n"><a href="#t864">864</a></span><span class="t">    <span class="nam">account_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'account.account'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Account'</span><span class="op">,</span> <span class="nam">ondelete</span><span class="op">=</span><span class="str">'cascade'</span><span class="op">,</span> <span class="nam">domain</span><span class="op">=</span><span class="op">[</span><span class="op">(</span><span class="str">'deprecated'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="nam">False</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t865" class="run"><span class="n"><a href="#t865">865</a></span><span class="t">    <span class="nam">journal_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'account.journal'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Journal'</span><span class="op">,</span> <span class="nam">ondelete</span><span class="op">=</span><span class="str">'cascade'</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"This field is ignored in a bank statement reconciliation."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t866" class="run"><span class="n"><a href="#t866">866</a></span><span class="t">    <span class="nam">label</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Char</span><span class="op">(</span><span class="nam">string</span><span class="op">=</span><span class="str">'Journal Item Label'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t867" class="run"><span class="n"><a href="#t867">867</a></span><span class="t">    <span class="nam">amount_type</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Selection</span><span class="op">(</span><span class="op">[</span>&nbsp;</span><span class="r"></span></p>
    <p id="t868" class="pln"><span class="n"><a href="#t868">868</a></span><span class="t">        <span class="op">(</span><span class="str">'fixed'</span><span class="op">,</span> <span class="str">'Fixed'</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t869" class="pln"><span class="n"><a href="#t869">869</a></span><span class="t">        <span class="op">(</span><span class="str">'percentage'</span><span class="op">,</span> <span class="str">'Percentage of balance'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t870" class="pln"><span class="n"><a href="#t870">870</a></span><span class="t">        <span class="op">]</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">'percentage'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t871" class="run"><span class="n"><a href="#t871">871</a></span><span class="t">    <span class="nam">amount</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Float</span><span class="op">(</span><span class="nam">digits</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">100.0</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Fixed amount will count as a debit if it is negative, as a credit if it is positive."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t872" class="run"><span class="n"><a href="#t872">872</a></span><span class="t">    <span class="nam">tax_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'account.tax'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Tax'</span><span class="op">,</span> <span class="nam">ondelete</span><span class="op">=</span><span class="str">'restrict'</span><span class="op">,</span> <span class="nam">domain</span><span class="op">=</span><span class="op">[</span><span class="op">(</span><span class="str">'type_tax_use'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="str">'purchase'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t873" class="run"><span class="n"><a href="#t873">873</a></span><span class="t">    <span class="nam">analytic_account_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'account.analytic.account'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Analytic Account'</span><span class="op">,</span> <span class="nam">ondelete</span><span class="op">=</span><span class="str">'set null'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t874" class="pln"><span class="n"><a href="#t874">874</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t875" class="run"><span class="n"><a href="#t875">875</a></span><span class="t">    <span class="nam">second_account_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'account.account'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Second Account'</span><span class="op">,</span> <span class="nam">ondelete</span><span class="op">=</span><span class="str">'cascade'</span><span class="op">,</span> <span class="nam">domain</span><span class="op">=</span><span class="op">[</span><span class="op">(</span><span class="str">'deprecated'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="nam">False</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t876" class="run"><span class="n"><a href="#t876">876</a></span><span class="t">    <span class="nam">second_journal_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'account.journal'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Second Journal'</span><span class="op">,</span> <span class="nam">ondelete</span><span class="op">=</span><span class="str">'cascade'</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"This field is ignored in a bank statement reconciliation."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t877" class="run"><span class="n"><a href="#t877">877</a></span><span class="t">    <span class="nam">second_label</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Char</span><span class="op">(</span><span class="nam">string</span><span class="op">=</span><span class="str">'Second Journal Item Label'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t878" class="run"><span class="n"><a href="#t878">878</a></span><span class="t">    <span class="nam">second_amount_type</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Selection</span><span class="op">(</span><span class="op">[</span>&nbsp;</span><span class="r"></span></p>
    <p id="t879" class="pln"><span class="n"><a href="#t879">879</a></span><span class="t">        <span class="op">(</span><span class="str">'fixed'</span><span class="op">,</span> <span class="str">'Fixed'</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t880" class="pln"><span class="n"><a href="#t880">880</a></span><span class="t">        <span class="op">(</span><span class="str">'percentage'</span><span class="op">,</span> <span class="str">'Percentage of amount'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t881" class="pln"><span class="n"><a href="#t881">881</a></span><span class="t">        <span class="op">]</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">"Second Amount type"</span><span class="op">,</span><span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">'percentage'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t882" class="run"><span class="n"><a href="#t882">882</a></span><span class="t">    <span class="nam">second_amount</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Float</span><span class="op">(</span><span class="nam">string</span><span class="op">=</span><span class="str">'Second Amount'</span><span class="op">,</span> <span class="nam">digits</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">required</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">100.0</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">"Fixed amount will count as a debit if it is negative, as a credit if it is positive."</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t883" class="run"><span class="n"><a href="#t883">883</a></span><span class="t">    <span class="nam">second_tax_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'account.tax'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Second Tax'</span><span class="op">,</span> <span class="nam">ondelete</span><span class="op">=</span><span class="str">'restrict'</span><span class="op">,</span> <span class="nam">domain</span><span class="op">=</span><span class="op">[</span><span class="op">(</span><span class="str">'type_tax_use'</span><span class="op">,</span> <span class="str">'='</span><span class="op">,</span> <span class="str">'purchase'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t884" class="run"><span class="n"><a href="#t884">884</a></span><span class="t">    <span class="nam">second_analytic_account_id</span> <span class="op">=</span> <span class="nam">fields</span><span class="op">.</span><span class="nam">Many2one</span><span class="op">(</span><span class="str">'account.analytic.account'</span><span class="op">,</span> <span class="nam">string</span><span class="op">=</span><span class="str">'Second Analytic Account'</span><span class="op">,</span> <span class="nam">ondelete</span><span class="op">=</span><span class="str">'set null'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t885" class="pln"><span class="n"><a href="#t885">885</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t886" class="run"><span class="n"><a href="#t886">886</a></span><span class="t">    <span class="op">@</span><span class="nam">api</span><span class="op">.</span><span class="nam">onchange</span><span class="op">(</span><span class="str">'name'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t887" class="pln"><span class="n"><a href="#t887">887</a></span><span class="t">    <span class="key">def</span> <span class="nam">onchange_name</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t888" class="mis show_mis"><span class="n"><a href="#t888">888</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">label</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">name</span>&nbsp;</span><span class="r"></span></p>
</div>
<div id="footer">
    <div class="content">
        <p>
            <a class="nav" href="index.html">&#xab; index</a> &nbsp; &nbsp; <a class="nav" href="https://coverage.readthedocs.io">coverage.py v5.4</a>,
            created at 2021-02-24 19:43
        </p>
    </div>
</div>
</body>
</html>
